<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Shellè„šæœ¬-å®šæœŸåˆ é™¤å¼‚å¸¸Pod]]></title>
    <url>%2F2019%2F06%2F03%2FShell%E8%84%9A%E6%9C%AC-%E5%AE%9A%E6%9C%9F%E5%88%A0%E9%99%A4%E5%BC%82%E5%B8%B8Pod%2F</url>
    <content type="text"><![CDATA[éœ€æ±‚æœ‰çš„Podé‡å¯æ¬¡æ•°è¿‡å¤š 12345678[cicd-test@ops-jenkins-master ~]$ kubectl get pods |awk '&#123;if ($4 &gt;= 1) print $0 &#125;'NAME READY STATUS RESTARTS AGEcmsservice-vcg-com-57974bc4cf-vq6mk 1/1 Running 1 6m18sedgeservice-vcg-com-755b96fb78-v96s5 1/1 Running 1 3d23hedgeserviceweb-vcg-com-5655fc9899-8lxql 1/1 Running 1 3d23hnode-visualchina-web-8575cf78dc-8jr2k 1/1 Running 1 4h11mvdam-gateway-service-6b7d864d67-rdzrg 1/1 Running 1 3h36mvdam-passport-service-7c97d84b58-xhn6k 1/1 Running 6 3d22h è„šæœ¬12345678910111213141516171819202122232425262728#!/bin/bash#Author:zhy#Version:1.0#Date:20190603#########åˆ é™¤é‡å¯æ¬¡æ•°è¶…è¿‡5æ¬¡çš„PODset -eTime=`date +%Y%m%d%H%M%S`echo $Time &gt;&gt; /home/cicd-pro/cron/k8s_pod_restart.logif [[ `/usr/local/bin/kubectl --kubeconfig /home/cicd-pro/.kube/config get pods | awk '&#123;if ($4 &gt;= 5) print $0 &#125;' |grep -v 'NAME' |wc -l` -eq 0 ]];then echo 'æ— é‡å¯æ¬¡æ•°è¶…è¿‡5æ¬¡çš„POD' echo 'æ— é‡å¯æ¬¡æ•°è¶…è¿‡5æ¬¡çš„POD' &gt;&gt; /home/cicd-pro/cron/k8s_pod_restart.logelse echo 'å°†è¦åˆ é™¤å¦‚ä¸‹podï¼š' echo 'å°†è¦åˆ é™¤å¦‚ä¸‹podï¼š' &gt;&gt; /home/cicd-pro/cron/k8s_pod_restart.log /usr/local/bin/kubectl --kubeconfig /home/cicd-pro/.kube/config get pods | awk '&#123;if ($4 &gt;= 5) print $1 &#125;'| grep -v 'NAME' echo `/usr/local/bin/kubectl --kubeconfig /home/cicd-pro/.kube/config get pods | awk '&#123;if ($4 &gt;= 5) print $1 &#125;'| grep -v 'NAME'` &gt;&gt; /home/cicd-pro/cron/k8s_pod_restart.log for i in `/usr/local/bin/kubectl --kubeconfig /home/cicd-pro/.kube/config get pods | awk '&#123;if ($4 &gt;= 5) print $1 &#125;' | grep -v 'NAME'`; do echo $i /usr/local/bin/kubectl --kubeconfig /home/cicd-pro/.kube/config delete pod $i donefi]]></content>
  </entry>
  <entry>
    <title><![CDATA[å¥‡è‘©éœ€æ±‚-jenkinsè„šæœ¬]]></title>
    <url>%2F2019%2F05%2F30%2F%E5%A5%87%E8%91%A9%E9%9C%80%E6%B1%82-jenkins%E8%84%9A%E6%9C%AC%2F</url>
    <content type="text"><![CDATA[jenkins é¡¹ç›®ä¸­çš„shellè„šæœ¬ï¼š å®žçŽ° è‡ªåŠ¨æž„å»ºåŽ è®¿é—®å¾®æœåŠ¡å¯ä»¥èŽ·å– Kubernetes podé•œåƒåœ°å€ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657set -eTime=`date +%Y%m%d%H%M%S`WorkDir=`pwd`if [[ $&#123;Scope&#125; == "æµ‹è¯•çŽ¯å¢ƒ" ]]; then Branch="release" ScopeName="test"fiif [[ $&#123;Scope&#125; == "é¢„å‘çŽ¯å¢ƒ" ]]; then Branch="master" ScopeName="pre"fiif [[ $&#123;Scope&#125; == "ç”Ÿäº§çŽ¯å¢ƒ" ]]; then Branch="master" ScopeName="pro"ficat &gt; Dockerfile &lt;&lt;EOFFROM registry-vpc.cn-beijing.aliyuncs.com/vcgcs/flaskWORKDIR /usr/src/appADD . .CMD python manager.pyEOFcat &gt; manager.py &lt;&lt;EOFfrom flask import Flaskfrom flask import requestimport osapp = Flask(__name__)@app.route('/',methods=["GET"])def cicd_test(): if request.method == 'GET': test = os.popen("/usr/src/app/kubectl --kubeconfig /usr/src/app/test-config get deployment cicd-test -o yaml |grep image |grep aliyuncs |awk -F '- image:' '&#123;print \$2&#125;'").read() pre = os.popen("/usr/src/app/kubectl --kubeconfig /usr/src/app/pre-config get deployment cicd-test -o yaml |grep image |grep aliyuncs |awk -F '- image:' '&#123;print \$2&#125;'").read() pro = os.popen("/usr/src/app/kubectl --kubeconfig /usr/src/app/pro-config get deployment cicd-test -o yaml |grep image |grep aliyuncs |awk -F '- image:' '&#123;print \$2&#125;'").read() return "testçŽ¯å¢ƒçš„é•œåƒåœ°å€: %s ,preçŽ¯å¢ƒçš„é•œåƒåœ°å€: %s , proçŽ¯å¢ƒçš„é•œåƒåœ°å€: %s" % (test,pre,pro)if __name__ == '__main__': app.run(host='0.0.0.0',port='5001',debug=True)EOFdocker build -t registry-vpc.cn-beijing.aliyuncs.com/vcg/cicd-test:$&#123;ScopeName&#125;-$Time .docker push registry-vpc.cn-beijing.aliyuncs.com/vcg/cicd-test:$&#123;ScopeName&#125;-$Timedocker rmi -f registry-vpc.cn-beijing.aliyuncs.com/vcg/cicd-test:$&#123;ScopeName&#125;-$Timeif [[ $&#123;Scope&#125; == "æµ‹è¯•çŽ¯å¢ƒ" ]]; then su - cicd-test -c "kubectl set image deployment cicd-test cicd-test=registry-vpc.cn-beijing.aliyuncs.com/vcg/cicd-test:$&#123;ScopeName&#125;-$Time"fiif [[ $&#123;Scope&#125; == "é¢„å‘çŽ¯å¢ƒ" ]]; then su - cicd-pre -c "kubectl set image deployment cicd-test cicd-test=registry-vpc.cn-beijing.aliyuncs.com/vcg/cicd-test:$&#123;ScopeName&#125;-$Time"fiif [[ $&#123;Scope&#125; == "ç”Ÿäº§çŽ¯å¢ƒ" ]]; then su - cicd-pro -c "kubectl set image deployment cicd-test cicd-test=registry-vpc.cn-beijing.aliyuncs.com/vcg/cicd-test:$&#123;ScopeName&#125;-$Time"fi æ•ˆæžœä¸ºï¼š 1testçŽ¯å¢ƒçš„é•œåƒåœ°å€: registry-vpc.cn-beijing.aliyuncs.com/vcg/cicd-test:test-20190530160557 ,preçŽ¯å¢ƒçš„é•œåƒåœ°å€: registry-vpc.cn-beijing.aliyuncs.com/vcg/cicd-test:pre-20190530162226 , proçŽ¯å¢ƒçš„é•œåƒåœ°å€: registry-vpc.cn-beijing.aliyuncs.com/vcg/cicd-test:pro-20190530162233]]></content>
      <tags>
        <tag>Kubernetes</tag>
        <tag>Jenkins</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginx-æ—¥å¿—åˆ‡å‰²]]></title>
    <url>%2F2019%2F05%2F27%2FNginx-%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2%2F</url>
    <content type="text"><![CDATA[nginxæ—¥å¿—æŒ‰å¤©è¿›è¡Œåˆ‡å‰²ï¼Œé€šè¿‡å†™shellè„šæœ¬ï¼Œåˆ›å»ºä»¥æ—¥æœŸå‘½åæ–‡ä»¶ 12345678910111213141516171819202122232425262728293031#!/usr/bin/env bashset -e# å®šä¹‰nginx æ—¥å¿—è·¯å¾„LOG_PATH="/var/gb/logs/"# å®šä¹‰nginx è®¿é—®æ—¥å¿—æ–‡ä»¶åç§°ACCESS_LOG="access.log"ERROR_LOG="error.log"for i in `find $LOG_PATH -name "$ACCESS_LOG"`; do cd $(dirname $i) # åˆ‡å‰²accessæ—¥å¿— if [[ -f $ACCESS_LOG ]]; then cp &#123;,$(date +%F)-&#125;$&#123;ACCESS_LOG&#125; : &gt; $ACCESS_LOG fi # å¦‚æžœerroræ—¥å¿—&gt;20mï¼Œåˆ‡ if [[ -f $ERROR_LOG ]]; then ERROR_SIZE=`ls -l $ERROR_LOG | awk '&#123; print $5 &#125;'` if [[ $ERROR_SIZE -gt 20971520 ]]; then cp &#123;,$(date +%F)-&#125;$&#123;ERROR_LOG&#125; : &gt; $&#123;ERROR_LOG&#125; fi fidone# æŸ¥æ‰¾nginx æ—¥å¿—ç›®å½•ä¸‹7å¤©å‰çš„æ—¥å¿—å¹¶åˆ é™¤find $&#123;LOG_PATH&#125; -type f -name "*-$&#123;ACCESS_LOG&#125;" -mtime +7 -deletefind $&#123;LOG_PATH&#125; -type f -name "*-$&#123;ERROR_LOG&#125;" -mtime +7 -delete]]></content>
  </entry>
  <entry>
    <title><![CDATA[Hexoåšå®¢ç¾ŽåŒ–æ·»åŠ live2dåŠ¨ç”»]]></title>
    <url>%2F2019%2F05%2F27%2FHexo%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96%E6%B7%BB%E5%8A%A0live2d%E5%8A%A8%E7%94%BB%2F</url>
    <content type="text"><![CDATA[hexo-helper-live2d GitHubåœ°å€ å®‰è£…æ’ä»¶ åœ¨hexoæ ¹ç›®å½•æ‰§è¡Œ 1npm install --save hexo-helper-live2d é€‰æ‹©åŠ¨ç”»æ¨¡åž‹ æ¨¡åž‹åœ°å€ live2d-widget-model-chitose live2d-widget-model-epsilon2_1 live2d-widget-model-gf live2d-widget-model-haru live2d-widget-model-haruto live2d-widget-model-hibiki live2d-widget-model-hijiki live2d-widget-model-izumi live2d-widget-model-koharu live2d-widget-model-miku live2d-widget-model-ni-j live2d-widget-model-nico live2d-widget-model-nietzsche live2d-widget-model-nipsilon live2d-widget-model-nito live2d-widget-model-shizuku live2d-widget-model-tororo live2d-widget-model-tsumiki live2d-widget-model-unitychan live2d-widget-model-wanko live2d-widget-model-z16 æœ¬æ¬¡é€‰æ‹©å®‰è£…live2d-widget-model-haruto 1npm install live2d-widget-model-haruto æ‹·è´èµ„æº åœ¨hexoæ ¹ç›®å½•live2d_models 1mkdir -p live2d_models cpæ¨¡åž‹æ–‡ä»¶ 1cp -r node_modules/live2d-widget-model-haruto/ live2d_models/ ç¼–è¾‘ä¸»é…ç½®ç¼–è¾‘_config.yml 12345678910111213141516live2d: enable: true scriptFrom: local pluginRootPath: live2dw/ pluginJsPath: lib/ pluginModelPath: assets/ tagMode: false debug: false model: use: live2d-widget-model-haruto display: position: right width: 150 height: 300 mobile: show: true é‡æ–°éƒ¨ç½²1hexo clean &amp;&amp; hexo g &amp;&amp; hexo d æˆ‘éƒ¨ç½²åˆ°GitHubä¸Šçš„åŸŸåæ­£å¸¸ï¼ŒæœåŠ¡å™¨ä¸Šçš„æ²¡ç”Ÿæ•ˆï¼Œé‡å¯è¿›ç¨‹åŽç”Ÿæ•ˆã€‚]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nextä¸»é¢˜å¢žåŠ åŠ¨æ€èƒŒæ™¯å¹¶è®¾ç½®é€æ˜ŽåŒ–]]></title>
    <url>%2F2019%2F05%2F27%2FNext%E4%B8%BB%E9%A2%98%E5%A2%9E%E5%8A%A0%E5%8A%A8%E6%80%81%E8%83%8C%E6%99%AF%E5%B9%B6%E8%AE%BE%E7%BD%AE%E9%80%8F%E6%98%8E%E5%8C%96%2F</url>
    <content type="text"><![CDATA[ç¼–è¾‘ä¸»é¢˜é…ç½®ç¼–è¾‘ themes/next/_config.yml 12345678#canvas_nest: falsecanvas_nest: enable: true onmobile: true # display on mobile or not color: &apos;0,0,255&apos; # RGB values, use &apos;,&apos; to separate opacity: 0.5 # the opacity of line: 0~1 zIndex: -1 # z-index property of the background count: 99 # the number of lines é‡æ–°éƒ¨ç½²1hexo clean &amp;&amp; hexo g &amp;&amp; hexo d]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hexo-Nextä¸»é¢˜æ·»åŠ æœç´¢åŠŸèƒ½]]></title>
    <url>%2F2019%2F05%2F27%2FHexo-Next%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD%2F</url>
    <content type="text"><![CDATA[å®‰è£…æ’ä»¶åšå®¢æ ¹ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1npm install hexo-generator-searchdb --save ä¿®æ”¹ä¸»é…ç½®ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š_config.yaml 12345search: path: search.xml field: post format: html limit: 10000 ä¿®æ”¹ä¸»é¢˜é…ç½®ç¼–è¾‘ themes/next/_config.yml 12local_search: enable: true é‡æ–°éƒ¨ç½²1hexo clean &amp;&amp; hexo g &amp;&amp; hexo d]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Kubernetes-HostAliases]]></title>
    <url>%2F2019%2F05%2F09%2FKubernetes-HostAliases%2F</url>
    <content type="text"><![CDATA[https://kubernetes.io/docs/concepts/services-networking/add-entries-to-pod-etc-hosts-with-host-aliases/ k8sä¸Šå¾®æœåŠ¡ä¹‹é—´å¯ä»¥é€šè¿‡serviceçš„åŸŸåæ¥äº’ç›¸è®¿é—®ã€‚åŸŸåçš„è§£æžæ˜¯ä¸€èˆ¬æ˜¯é€šè¿‡åœ¨é›†ç¾¤ä¸­çš„kube-dnsæ¥å®Œæˆçš„ã€‚ å¦‚éœ€å‘Podçš„/etc/hostsæ–‡ä»¶æ·»åŠ æ¡ç›®å®žçŽ°è§£æžéœ€æ±‚æ—¶ï¼Œå¯ä»¥ä½¿ç”¨Pod Specä¸­çš„HostAliaseså­—æ®µæ·»åŠ è‡ªå®šä¹‰æ¡ç›®ã€‚ ä¾‹å¦‚ï¼š 123456789101112131415161718192021222324service/networking/hostaliases-pod.yaml apiVersion: v1kind: Podmetadata: name: hostaliases-podspec: restartPolicy: Never hostAliases: - ip: "127.0.0.1" hostnames: - "foo.local" - "bar.local" - ip: "10.1.2.3" hostnames: - "foo.remote" - "bar.remote" containers: - name: cat-hosts image: busybox command: - cat args: - "/etc/hosts" ç¤ºä¾‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152apiVersion: apps/v1beta2kind: Deploymentmetadata: labels: app: vcg-gateway name: vcg-gateway namespace: defaultspec: replicas: 1 selector: matchLabels: app: vcg-gateway strategy: rollingUpdate: maxSurge: 25% maxUnavailable: 25% type: RollingUpdate template: metadata: labels: app: vcg-gateway spec: containers: - env: - name: aliyun_logs_vcg-gateway value: stdout image: &gt;- registry-vpc.cn-beijing.aliyuncs.com/vcg/vcg-gateway:pro-20190423162116 imagePullPolicy: Always name: vcg-gateway resources: limits: cpu: '1' memory: 4Gi requests: cpu: 500m memory: 1000Mi dnsPolicy: ClusterFirst hostAliases: - hostnames: - www.vcg.com ip: 39.97.197.135 - hostnames: - www1.visualchina.com - www1.vcg.com ip: 39.97.21.16 imagePullSecrets: - name: registry-vpc.cn-beijing.aliyuncs.com restartPolicy: Always schedulerName: default-scheduler securityContext: &#123;&#125; terminationGracePeriodSeconds: 30]]></content>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Kubernetes-Secrets]]></title>
    <url>%2F2019%2F05%2F05%2FKubernetes-Secrets%2F</url>
    <content type="text"><![CDATA[èƒŒæ™¯ä¿¡æ¯è‹¥æ‚¨éœ€è¦åœ¨ Kubernetes é›†ç¾¤ä¸­ä½¿ç”¨ä¸€äº›æ•æ„Ÿçš„é…ç½®ï¼Œæ¯”å¦‚å¯†ç ã€è¯ä¹¦ç­‰ä¿¡æ¯æ—¶ï¼Œå»ºè®®ä½¿ç”¨å¯†é’¥ï¼ˆsecretï¼‰ï¼Œå³ä¿å¯†å­—å…¸ã€‚ å¯†é’¥æœ‰å¤šç§ç±»åž‹ï¼Œä¾‹å¦‚ï¼š Service Accountï¼šç”¨æ¥è®¿é—® Kubernetes APIï¼Œç”± Kubernetes è‡ªåŠ¨åˆ›å»ºï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨æŒ‚è½½åˆ° Pod çš„/run/secrets/kubernetes.io/serviceaccountç›®å½•ä¸­ã€‚ Opaqueï¼šbase64 ç¼–ç æ ¼å¼çš„ Secretï¼Œç”¨æ¥å­˜å‚¨å¯†ç ã€è¯ä¹¦ç­‰æ•æ„Ÿä¿¡æ¯ã€‚ Opaque ç±»åž‹çš„æ•°æ®æ˜¯ä¸€ä¸ª map ç±»åž‹ï¼Œè¦æ±‚value æ˜¯ base64 ç¼–ç æ ¼å¼ æ‚¨ä¹Ÿå¯é€šè¿‡å‘½ä»¤è¡Œæ‰‹åŠ¨åˆ›å»ºå¯†é’¥ï¼Œè¯·å‚è§ kubernetes secret äº†è§£æ›´å¤šä¿¡æ¯ã€‚ å‘½ä»¤åˆ›å»º1234567891011kubectl create secretCreate a secret using specified subcommand.Available Commands: docker-registry Create a secret for use with a Docker registry generic Create a secret from a local file, directory or literal value tls Create a TLS secretUsage: kubectl create secret [flags] [options] æŸ¥çœ‹è¯ä¹¦12345[cicd-jd@ops-jenkins-master ssl]$ kubectl get secretsNAME TYPE DATA AGEdefault-token-msfm9 kubernetes.io/service-account-token 3 24dregistry.cn-beijing.aliyuncs.com kubernetes.io/dockerconfigjson 1 24dveer-https kubernetes.io/tls 2 3h25m 123456789101112[cicd-jd@ops-jenkins-master ssl]$ kubectl describe secrets veer-httpsName: veer-httpsNamespace: defaultLabels: &lt;none&gt;Annotations: &lt;none&gt;Type: kubernetes.io/tlsData====tls.crt: 3941 bytestls.key: 1676 bytes åˆ é™¤1kubectl delete secret $NAME ç¤ºä¾‹åˆ›å»ºSSLè¯ä¹¦ å‡†å¤‡å…¬é’¥ã€ç§é’¥æ–‡ä»¶12[cicd-jd@ops-jenkins-master ssl]$ lsveer.key veer.pem åˆ›å»ºsecret1kubectl create secret tls veer-https --cert=./veer.pem --key=./veer.key éªŒè¯123[cicd-jd@ops-jenkins-master ssl]$ kubectl get secrets veer-httpsNAME TYPE DATA AGEveer-https kubernetes.io/tls 2 3h22m]]></content>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginx-ingress controlleréƒ¨ç½²]]></title>
    <url>%2F2019%2F05%2F05%2FNginx-ingress-controller%E9%83%A8%E7%BD%B2%2F</url>
    <content type="text"><![CDATA[https://docs.jdcloud.com/cn/jcs-for-kubernetes/deploy-ingress-nginx-controller Ingress æ˜¯ä»ŽKubernetesé›†ç¾¤å¤–éƒ¨è®¿é—®é›†ç¾¤å†…éƒ¨æœåŠ¡çš„å…¥å£ï¼Œæ¦‚å¿µç¤ºæ„å¯å‚è€ƒä¸‹æ–¹è¯´æ˜Žã€‚ä½ å¯ä»¥ç»™Ingressé…ç½®æä¾›å¤–éƒ¨å¯è®¿é—®çš„URLã€è´Ÿè½½å‡è¡¡ã€SSLã€åŸºäºŽåç§°çš„è™šæ‹Ÿä¸»æœºç­‰ã€‚ç”¨æˆ·é€šè¿‡POST Ingressèµ„æºåˆ°API serverçš„æ–¹å¼æ¥è¯·æ±‚ingressã€‚ 12345internet |[ Ingress ]--|-----|--[ Services ] Ingress controllerè´Ÿè´£å®žçŽ°Ingressã€‚Ingress controlleråœ¨Kubernetesé›†ç¾¤ä¸­é»˜è®¤ä¸ä¼šè‡ªåŠ¨å¯ç”¨ï¼Œæ‚¨å¯ä»¥åœ¨ä¸€ä¸ªpodä¸­éƒ¨ç½²ä»»æ„ç±»åž‹çš„è‡ªå®šä¹‰Ingress Controllerã€‚æœ¬æ–‡å°†ä»¥Nginx-ingress controllerä¸ºä¾‹ï¼Œè¯´æ˜ŽControlleréƒ¨ç½²å’ŒIngresså®šä¹‰ã€‚æ›´å¤šå¤–éƒ¨ç±»åž‹çš„Ingresss Controllerå‚è€ƒKuberneteså®˜æ–¹æ–‡æ¡£ã€‚ çŽ¯å¢ƒå‡†å¤‡ ä»Žgithubä¸‹è½½nginx-ingress controlleræœ€æ–°çš„å®‰è£…éƒ¨ç½²æ–‡ä»¶,å¹¶å°†éƒ¨ç½²æ–‡ä»¶è§£åŽ‹ç¼©åˆ°æœ¬åœ°ç›®å½•ï¼š123wget https://github.com/nginxinc/kubernetes-ingress/archive/v1.4.5.tar.gztar -zxvf v1.4.5.tar.gz è¯´æ˜Žï¼šæœ¬æ–‡è¯´æ˜Žåœ¨1.12.3ç‰ˆæœ¬çš„é›†ç¾¤ä¸Šå¦‚ä½•éƒ¨ç½²nginx-ingress controllerï¼Œå¦‚é›†ç¾¤ç‰ˆæœ¬ä¸åŒï¼Œé€‰æ‹©å…¶ä»–é€‚åˆçš„ginx-ingress controllerå®‰è£…éƒ¨ç½²æ–‡ä»¶ã€‚ è¿›å…¥è§£åŽ‹ç¼©åŽçš„nginx-ingress controllerå®‰è£…ç›®å½•ï¼›1cd kubernetes-ingress-1.4.5/deployments å®‰è£…nginx-ingress controller ä¸ºnginx-ingress controlleråˆ›å»ºä¸€ä¸ªnamespaceå’Œservice accountï¼š1kubectl apply -f common/ns-and-sa.yaml ä¸ºNGINXé»˜è®¤Serveré…ç½®TLSè¯ä¹¦å’Œkeyï¼Œå¹¶å°†TLSè¯ä¹¦å’Œkeyä¿å­˜åˆ°secretä¸­ï¼š1kubectl apply -f common/default-server-secret.yaml è¯´æ˜Žï¼šå»ºè®®ä½¿ç”¨åˆé€‚çš„TLSè¯ä¹¦å’Œkeyæ›¿æ¢default-server-secret.yamlæ–‡ä»¶ä¸­è‡ªç­¾å‘çš„è¯ä¹¦å’Œkeyã€‚ åˆ›å»ºconfig mapä¿å­˜NGINXçš„è‡ªå®šä¹‰é…ç½®ï¼š1kubectl apply -f common/nginx-config.yaml è¯´æ˜Žï¼šç›®å‰æä¾›çš„config mapä¸­çš„dataä¸ºç©ºï¼Œæ‚¨å¯ä»¥æŒ‰éœ€æ·»åŠ è‡ªå®šä¹‰é…ç½®ã€‚ ä¸ºç¬¬1æ­¥ä¸­åˆ›å»ºçš„service accounté…ç½®RBACï¼š1kubectl apply -f rbac/rbac.yaml ä»¥Deploymentçš„æ–¹å¼éƒ¨ç½²nginx-ingress controller:1kubectl apply -f deployment/nginx-ingress.yaml æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç¡®å®šéƒ¨ç½²nginx-ingress controllerçš„Deploymentè¿è¡Œæ­£å¸¸ï¼š1234 kubectl get deployment -n nginx-ingress NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE nginx-ingress 1 1 1 1 24d åˆ›å»ºingressçš„LoadBalanceåœ¨ Kubernetesé›†ç¾¤ä¸­ï¼Œæ¯ä¸ªPodéƒ½å…·æœ‰å”¯ä¸€çš„å†…éƒ¨ IP åœ°å€ï¼Œä½†æ˜¯Deploymentä¸­çš„Podéšæ—¶å¯èƒ½è¢«åˆ é™¤æˆ–åˆ›å»ºï¼Œå¯¼è‡´Pod IPåœ°å€ä¸æ–­å˜åŒ–ã€‚å› æ­¤éœ€è¦åˆ›å»ºä¸€ä¸ªServiceå¯¹å¤–æš´éœ²Podä¸­çš„åº”ç”¨ã€‚Serviceå…·æœ‰å”¯ä¸€çš„å›ºå®šIPåœ°å€ä¸”èƒ½å¤Ÿä¸ºåŽç«¯æ·»åŠ çš„æˆå‘˜Podæä¾›è´Ÿè½½å‡è¡¡ã€‚åœ¨äº¬ä¸œäº‘Kubernetesé›†ç¾¤ä¸­æ‚¨å¯ä»¥ä½¿ç”¨LoadBalanceç±»åž‹çš„Serviceï¼Œä¸ºServiceå…³è”åˆ›å»ºä¸€ä¸ªåº”ç”¨è´Ÿè½½å‡è¡¡ï¼Œå¹¶é€šè¿‡è´Ÿè½½å‡è¡¡ç»‘å®šçš„å…¬ç½‘IPï¼Œå°†ServiceåŽç«¯å…³è”çš„nginx-ingress controlleråº”ç”¨æš´éœ²åˆ°å…¬ç½‘ï¼š 123456789101112131415161718apiVersion: v1kind: Servicemetadata: name: nginx-ingress #å»ºè®®Serviceä½¿ç”¨ä¸Žnginx-ingress controllerå¯¹åº”çš„Deploymentåç§°ç›¸åŒçš„åç§° namespace: nginx-ingressspec: type: LoadBalancer ports: - port: 80 targetPort: 80 protocol: TCP name: http - port: 443 targetPort: 443 protocol: TCP name: https selector: app: nginx-ingress è¯´æ˜Žï¼šæœ¬ä¾‹ä½¿ç”¨80å’Œ443ç«¯å£ç»‘å®šnginx-ingress controlleråº”ç”¨ å°†ä¸Šè¿°Serviceå®šä¹‰åˆ°ingress.yamlæ–‡ä»¶ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åˆ›å»ºå¯¹åº”çš„Serviceï¼š 1kubectl create -f ingress.yaml èŽ·å–å…¬ç½‘IPç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç¡®å®šServiceå·²ç»é…ç½®å®Œæˆï¼Œå¹¶èŽ·å–Serviceä¸Šé…ç½®çš„External IPå­—æ®µ 1234kubectl get svc -n nginx-ingressNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEnginx-ingress LoadBalancer 192.168.58.218 114.67.80.218 80:32436/TCP,443:30110/TCP 3h13m è¯´æ˜Žï¼šServiceçš„External IPå°†ä½œä¸ºnginx-ingress controllerçš„VIPï¼Œä¸ºé›†ç¾¤ä¸­ä½¿ç”¨nginx-ingress controllerçš„Ingressæä¾›å…¬ç½‘è®¿é—®å…¥å£ å…³è”çš„External IPä½œä¸ºå…¬ç½‘å…¥å£IPæœ€åŽï¼Œåœ¨Ingress controllerçš„Deploymentéƒ¨ç½²æ–‡ä»¶nginx-ingress.yamlä¸­å¢žåŠ ä¸€å¯¹çŽ¯å¢ƒå˜é‡â€-args -external-service=nginx-ingressâ€,é…ç½®Ingress controllerä½¿ç”¨Serviceåç§°å…³è”çš„External IPä½œä¸ºå…¬ç½‘å…¥å£IPï¼š 1234args: - -nginx-configmaps=$(POD_NAMESPACE)/nginx-config - -default-server-tls-secret=$(POD_NAMESPACE)/default-server-secret - -external-service=nginx-ingress #æ–°å¢žå†…å®¹ 1kubectl apply -f deployment/nginx-ingress.yaml #é‡æ–°éƒ¨ç½²nginx-ingress controller éªŒè¯Podæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ç¡®å®šnginx-ingress controllerç›¸å…³çš„Podè¿è¡Œæ­£å¸¸ï¼Œå³å¯å®Œæˆnginx ingress controlleréƒ¨ç½²ï¼š 12345kubectl get pod -n nginx-ingressNAME READY STATUS RESTARTS AGEnginx-ingress-f67b87b88-5cspd 1/1 Running 0 3h11mnginx-ingress-f67b87b88-n7qnw 1/1 Running 0 3h13m ç¤ºä¾‹åº”ç”¨ä¾‹å¦‚ï¼šé…ç½®www2.veer.comçš„ingressé…ç½® 123456789101112131415161718apiVersion: extensions/v1beta1kind: Ingressmetadata: name: cms-veer # å˜é‡ï¼šåå­— namespace: defaultspec: rules: - host: www2.veer.com # å˜é‡ï¼šurl http: paths: - backend: serviceName: node-vcg-veer-pre # å˜é‡ï¼šåŽç«¯åº”ç”¨service servicePort: 80 # å˜é‡ï¼šåŽç«¯åº”ç”¨serviceç«¯å£ path: / tls: - hosts: - www2.veer.com secretName: veer-https # å˜é‡ï¼šsslè¯ä¹¦]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
        <tag>Ingress</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Confluenceå®‰è£…-ç»´æŠ¤-è¿ç§»å®žè·µ]]></title>
    <url>%2F2019%2F04%2F29%2FConfluence%E5%AE%89%E8%A3%85-%E7%BB%B4%E6%8A%A4-%E8%BF%81%E7%A7%BB%E5%AE%9E%E8%B7%B5%2F</url>
    <content type="text"><![CDATA[Confluenceä»‹ç» Confluenceæ˜¯ç”±æ¾³å¤§åˆ©äºšè½¯ä»¶å…¬å¸Atlassianå¼€å‘å’Œå‘å¸ƒçš„åä½œè½¯ä»¶ç¨‹åº Confluenceæ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä¼ä¸šçŸ¥è¯†ç®¡ç†ä¸ŽååŒè½¯ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨äºŽæž„å»ºä¼ä¸šwikiã€‚ä½¿ç”¨ç®€å•ï¼Œä½†å®ƒå¼ºå¤§çš„ç¼–è¾‘å’Œç«™ç‚¹ç®¡ç†ç‰¹å¾èƒ½å¤Ÿå¸®åŠ©å›¢é˜Ÿæˆå‘˜ä¹‹é—´å…±äº«ä¿¡æ¯ã€æ–‡æ¡£åä½œã€é›†ä½“è®¨è®ºï¼Œä¿¡æ¯æŽ¨é€ã€‚ Confluenceä¸ºå›¢é˜Ÿæä¾›ä¸€ä¸ªåä½œçŽ¯å¢ƒã€‚åœ¨è¿™é‡Œï¼Œå›¢é˜Ÿæˆå‘˜é½å¿ƒååŠ›ï¼Œå„æ“…å…¶èƒ½ï¼ŒååŒåœ°ç¼–å†™æ–‡æ¡£å’Œç®¡ç†é¡¹ç›®ã€‚ä»Žæ­¤æ‰“ç ´ä¸åŒå›¢é˜Ÿã€ä¸åŒéƒ¨é—¨ä»¥åŠä¸ªäººä¹‹é—´ä¿¡æ¯å­¤å²›çš„åƒµå±€ï¼ŒConfluenceçœŸæ­£å®žçŽ°äº†ç»„ç»‡èµ„æºå…±äº«ã€‚ å®‰è£… https://confluence.atlassian.com/conf612/installing-confluence-on-linux-from-archive-file-958778538.html ä¸‹è½½å®‰è£…åŒ…Download the tar.gz file for your operating system - https://www.atlassian.com/software/confluence/download. æœ¬æ¬¡æ¼”ç¤ºæˆ‘ä¸‹è½½çš„æ–‡ä»¶åŒ…ä¸ºï¼šatlassian-confluence-6.12.0.zip å®‰è£…jdkçŽ¯å¢ƒ12yum install -y java-1.8.0-openjdk.x86_64java -version # éªŒè¯ åˆ›å»ºConfluenceç”¨æˆ·1useradd -create-home --comment "Account for running Confluence" --shell /bin/bash confluence è§£åŽ‹å®‰è£…åŒ…ã€åˆ›å»ºé…ç½®ã€é…ç½®æƒé™ç›®å½•è§„åˆ’ï¼š â€‹ å®‰è£…ç›®å½•ï¼š/data/vcg/confluence â€‹ æ•°æ®ç›®å½•ï¼š/data/vcg/confluence-home 1cp /root/atlassian-confluence-6.12.0.zip /data/vcg/ 1yum install unzip -y 123cd /data/vcg/unzip atlassian-confluence-6.12.0.zipmv atlassian-confluence-6.12.0 confluence 1mkdir -p /data/vcg/confluence-home 1234chown -R confluence /data/vcg/confluence/chmod -R u=rwx,go-rwx /data/vcg/confluence/chown -R confluence /data/vcg/confluence-home/chmod -R u=rwx,go-rwx /data/vcg/confluence-home/ æ•°æ®åº“vcgè¿™è¾¹ä½¿ç”¨çš„é˜¿é‡Œäº‘RDSæ•°æ®åº“ï¼Œæœªæ‰‹åŠ¨å®‰è£…MySQL æ•°æ®åº“ä½¿ç”¨MySQLï¼Œéœ€å®‰è£…é©±åŠ¨è½¯ä»¶ã€‚èŽ·å–mysql-connector-javaçš„å®‰è£…åŒ… 1cp mysql-connector-java-5.1.45-bin.jar /data/vcg/confluence/confluence/WEB-INF/lib/ é…ç½®1echo "confluence.home=/data/vcg/confluence-home/" &gt; confluence/confluence/WEB-INF/classes/confluence-init.properties 12 é¡µé¢é…ç½®1æµè§ˆå™¨è®¿é—®ip:8090 ç»§ç»­é…ç½®Confluence è¿ç§»å¤‡ä»½æ•°æ®ç™»å½•è€Confluenceç•Œé¢ï¼Œè¿›å…¥â€ç«™ç‚¹ç®¡ç†â€â€”â€œå¤‡ä»½å·²è¿˜åŽŸâ€ï¼Œç‚¹å‡»â€å¤‡ä»½â€ï¼Œå¦‚å›¾ æ•°æ®å¤‡ä»½è·¯å¾„ä¸ºï¼š/data/vcg/confluence-home/backups/ æ‹·è´å¤‡ä»½æ•°æ®åŒ…åˆ°æ–°æœåŠ¡å™¨å¤‡ä»½å¿…é¡»å¤åˆ¶è‡³/data/vcg/confluence-home/restoreç›®å½•ä¸­ã€‚ 1scp /data/vcg/confluence-home/backups/xmlexport-20190225-205713-119.zip root@'xxxx':/data/vcg/confluence-home/restore/ éƒ¨ç½²æ–°çš„Confluenceå¤‡ä»½æ¢å¤ç™»å½•æ–°çš„Confluenceçš„â€ç«™ç‚¹ç®¡ç†â€â€”â€œå¤‡ä»½å·²è¿˜åŽŸâ€ã€‚ ç»´æŠ¤å¤‡ä»½æ•°æ®å®šæœŸåˆ é™¤12crontab -e0 15 * * * find /data/vcg/confluence-home/backups/* -type f -mtime +5 -exec rm &#123;&#125; \; æ¼æ´žè¡¥ä¸(è¢«æ¤å…¥æŒ–çŸ¿ç¨‹åº) https://help.aliyun.com/noticelist/articleid/1000128459.html?spm=a2c4g.789213612.n2.10.2a716141mqqJjY è§£å†³åŠžæ³•ï¼šå‡çº§Widget Connector ç»„ä»¶ åŸ¹è®­æ–‡æ¡£]]></content>
      <tags>
        <tag>Confluence</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®°ä¸€æ¬¡Javaå¾®æœåŠ¡å®¹å™¨åŒ–ç»´æŠ¤å·¥ä½œ]]></title>
    <url>%2F2019%2F04%2F28%2F%E8%AE%B0%E4%B8%80%E6%AC%A1Java%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8%E5%8C%96%E7%BB%B4%E6%8A%A4%E5%B7%A5%E4%BD%9C%2F</url>
    <content type="text"><![CDATA[äº‹ä»¶èƒŒæ™¯ å®¹å™¨æž¶æž„ç”±Swarmè¿ç§»åˆ°Kubernetes Swarmé›†ç¾¤ä¸­æœåŠ¡å‘çŽ°ã€æœåŠ¡æ³¨å†Œä½¿ç”¨Consulï¼Œè¿ç§»åˆ°K8såŽæ³¨å†Œå‘çŽ°æ˜¯çš„K8sçš„kube-dnsåŸºç¡€ç»„ä»¶å®žçŽ°ã€‚ utilservice-vcg-comè¿™ä¸ªå¾®æœåŠ¡éƒ¨ç½²åœ¨ä¸¤å°ecsä¸Šï¼Œjava -jar å¯åŠ¨åŽ æ‰‹åŠ¨æ³¨å†Œåˆ°consulä¸­ï¼Œè¿™æ ·å®žçŽ°Swarmé›†ç¾¤ä¸­çš„åº”ç”¨å¯ä»¥é€šè¿‡Consulè®¿é—®utilæœåŠ¡ã€‚ æ€è·¯ ä¸Žç›¸å…³ç ”å‘æ²Ÿé€šï¼Œç¡®å®šutilserviceç¨‹åºä¸€äº›åŸºç¡€ä¿¡æ¯ï¼šæ¯”å¦‚ â€‹ éœ€è¦å“ªäº›åŸºç¡€ç»„ä»¶ï¼Œåœ¨ecsä¸Šéƒ¨ç½²é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•å¤„ç†çš„ â€‹ gitä»“åº“åœ°å€ã€æœåŠ¡å¯åŠ¨å‘½ä»¤ã€æœåŠ¡ç«¯å£ã€æ˜¯å¦è¿žæŽ¥æ•°æ®åº“ã€æœåŠ¡è°ƒç”¨å…³ç³»ã€‚ ç¡®å®šä½¿ç”¨jdkçŽ¯å¢ƒï¼Œéœ€è¦ä½¿ç”¨åˆ° wkhtmltopdf è¿™ä¸ªå‘½ä»¤ï¼Œç”¨äºŽç”Ÿæˆpdfï¼› ç”Ÿæˆçš„pdfè¿‡ç¨‹ä¼šæœ‰ å­—ä½“å’Œè¯­è¨€çš„é—®é¢˜ï¼Œéœ€æå‰å¤„ç†ã€‚ æ“ä½œ ç¡®å®šåŸºç¡€é•œåƒè®¿é—®https://hub.docker.comï¼Œæœç´¢ wkhtmltopdf å…³é”®è¯ ç¡®å®šåŸºç¡€é•œåƒä½¿ç”¨ buildo/java8-wkhtmltopdf ã€‚ Dockerfile (ç¬¬ä¸€ç‰ˆ)1FROM buildo/java8-wkhtmltopdf ä¸‹è½½JCEéœ€è¦ä½¿ç”¨åˆ°JCEï¼Œåœ¨oracleå®˜ç½‘ä¸‹è½½ã€‚ JDK7çš„ä¸‹è½½åœ°å€: http://www.oracle.com/technetwork/java/javase/downloads/jce-7-download-432124.htmlJDK8çš„ä¸‹è½½åœ°å€: http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html Java Cryptography Extension (JCE) æ— é™å¼ºåº¦æƒé™ç­–ç•¥æ–‡ä»¶ 8 ä¸‹è½½ Dockerfile (ç¬¬äºŒç‰ˆ)12345678FROM buildo/java8-wkhtmltopdfMAINTAINER hongye.zhao@vcg.comRUN mkdir -p /application/WORKDIR /application/ADD . .RUN unzip jce_policy-8.zip &amp;&amp; \ cp UnlimitedJCEPolicyJDK8/US_export_policy.jar /docker-java-home/jre/lib/security &amp;&amp; \ cp UnlimitedJCEPolicyJDK8/local_policy.jar /docker-java-home/jre/lib/security &amp;&amp; \ å¤„ç†ç¨‹åºæŠ¥é”™1ã€æ‰¾åˆ°ä¸åˆ° iSignature.pfx è¯ä¹¦ï¼šæŠ¥é”™æˆªå›¾ï¼š å¯ä»¥çœ‹åˆ°æ‰¾ä¸åˆ°/media/providerstamp/signature/iSignature.pfx è¯ä¹¦æ–‡ä»¶ï¼Œç®€å•ï¼Œä»Žè€æœåŠ¡å™¨ä¸Šæ‰¾åˆ°å¯¹åº”æ–‡ä»¶ï¼Œæ‹·è´è¿‡æ¥ã€‚ Dockerfile (ç¬¬ä¸‰ç‰ˆ)12345678910FROM buildo/java8-wkhtmltopdfMAINTAINER hongye.zhao@vcg.comRUN mkdir -p /application/WORKDIR /application/ADD . .RUN unzip jce_policy-8.zip &amp;&amp; \ cp UnlimitedJCEPolicyJDK8/US_export_policy.jar /docker-java-home/jre/lib/security &amp;&amp; \ cp UnlimitedJCEPolicyJDK8/local_policy.jar /docker-java-home/jre/lib/security &amp;&amp; \ mkdir -p /media/providerstamp/signature/ &amp;&amp; \ cp iSignature.pfx /media/providerstamp/signature/ &amp;&amp; \ 2ã€tmpDicä¸æ˜¯æ–‡ä»¶å¤¹ ç ”å‘æŸ¥çœ‹ä»£ç åŽç¡®å®šæ˜¯è¦ä½¿ç”¨ /media/providerstamp/temp/ ç›®å½•ï¼Œç´¢æ€§ç™»å½•è€æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹/media/providerstampä¸‹æ‰€æœ‰ç›®å½•ï¼Œéƒ½åˆ›å»ºå¥½ï¼Œå¹¶å°†éœ€è¦çš„æ–‡ä»¶scpæ‹·è´è¿‡æ¥ã€‚ çœ‹åˆ°è¿˜æœ‰ done ã€unitrustç›®å½•ï¼Œå¹¶ä¸”unitrustç›®å½•ä¸­çš„unitrust.key ç¨‹åºä¹Ÿä¼šç”¨åˆ°ã€‚ Dockerfile (ç¬¬å››ç‰ˆ)1234567891011121314FROM buildo/java8-wkhtmltopdfMAINTAINER hongye.zhao@vcg.comRUN mkdir -p /application/WORKDIR /application/ADD . .RUN unzip jce_policy-8.zip &amp;&amp; \ cp UnlimitedJCEPolicyJDK8/US_export_policy.jar /docker-java-home/jre/lib/security &amp;&amp; \ cp UnlimitedJCEPolicyJDK8/local_policy.jar /docker-java-home/jre/lib/security &amp;&amp; \ mkdir -p /media/providerstamp/signature/ &amp;&amp; \ mkdir -p /media/providerstamp/done/ &amp;&amp; \ mkdir -p /media/providerstamp/unitrust/ &amp;&amp; \ mkdir -p /media/providerstamp/temp/ &amp;&amp; \ cp unitrust.key /media/providerstamp/unitrust &amp;&amp; \ cp iSignature.pfx /media/providerstamp/signature/ &amp;&amp; \ 3ã€pdfå†…å®¹ä¹±ç ä¹±ç æ˜¯ç”±äºŽå­—ä½“é—®é¢˜ï¼Œç®€å•ç›´æŽ¥ï¼Œç›´æŽ¥ä»Žè€æœåŠ¡å™¨ä¸Šæ‹·è´ /usr/share/fonts ç›®å½•ã€‚ Dockerfile (ç¬¬äº”ç‰ˆ)12345678910111213141516171819FROM buildo/java8-wkhtmltopdfMAINTAINER hongye.zhao@vcg.comRUN mkdir -p /application/WORKDIR /application/ADD . .RUN unzip jce_policy-8.zip &amp;&amp; \ cp UnlimitedJCEPolicyJDK8/US_export_policy.jar /docker-java-home/jre/lib/security &amp;&amp; \ cp UnlimitedJCEPolicyJDK8/local_policy.jar /docker-java-home/jre/lib/security &amp;&amp; \ mkdir -p /media/providerstamp/signature/ &amp;&amp; \ mkdir -p /media/providerstamp/done/ &amp;&amp; \ mkdir -p /media/providerstamp/unitrust/ &amp;&amp; \ mkdir -p /media/providerstamp/temp/ &amp;&amp; \ cp unitrust.key /media/providerstamp/unitrust &amp;&amp; \ cp iSignature.pfx /media/providerstamp/signature/ &amp;&amp; \ rm -f /usr/local/bin/wkhtmltopdf &amp;&amp; \ rm -rf /usr/share/fonts &amp;&amp; \ cp wkhtmltopdf /usr/local/bin/ &amp;&amp; \ tar zxf fonts.tar.gz &amp;&amp; \ mv fonts/ /usr/share/ è‡³æ­¤ï¼Œæ­¤å¾®æœåŠ¡å®¹å™¨åŒ–å·²å®Œæˆã€‚ðŸ‘ðŸ‘ðŸ‘]]></content>
      <tags>
        <tag>Docker</tag>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Docker-é•œåƒimage]]></title>
    <url>%2F2019%2F04%2F23%2FDocker-%E9%95%9C%E5%83%8Fimage%2F</url>
    <content type="text"><![CDATA[Dockeré•œåƒæ˜¯å¯åŠ¨å®¹å™¨çš„åŸºçŸ³ã€‚ ä»€ä¹ˆæ˜¯Dockeré•œåƒ Dockeré•œåƒæ˜¯ç”±æ–‡ä»¶ç³»ç»Ÿå åŠ è€Œæˆã€‚æœ€åº•ç«¯æ˜¯ä¸€ä¸ªæ–‡ä»¶å¼•å¯¼ç³»ç»Ÿï¼Œå³bootfsã€‚Dockerç”¨æˆ·ä¸ä¼šä¸Žå¼•å¯¼æ–‡ä»¶ç³»ç»Ÿæœ‰ç›´æŽ¥çš„äº¤äº’ã€‚Dockeré•œåƒçš„ç¬¬äºŒå±‚æ˜¯rootæ–‡ä»¶ç³»ç»Ÿrootfsï¼Œé€šå¸¸æ˜¯ä¸€ç§æˆ–å¤šç§æ“ä½œç³»ç»Ÿï¼Œä¾‹å¦‚ubuntuç­‰ã€‚åœ¨Dockerä¸­ï¼Œæ–‡ä»¶ç³»ç»Ÿæ°¸è¿œéƒ½æ˜¯åªè¯»çš„ï¼Œåœ¨æ¯æ¬¡ä¿®æ”¹æ—¶ï¼Œéƒ½æ˜¯è¿›è¡Œæ‹·è´å åŠ ä»Žè€Œå½¢æˆæœ€ç»ˆçš„æ–‡ä»¶ç³»ç»Ÿã€‚Dockerç§°è¿™æ ·çš„æ–‡ä»¶ä¸ºé•œåƒã€‚ä¸€ä¸ªé•œåƒå¯ä»¥è¿­ä»£åœ¨å¦ä¸€ä¸ªé•œåƒçš„é¡¶éƒ¨ã€‚ä½äºŽä¸‹æ–¹çš„é•œåƒç§°ä¹‹ä¸ºçˆ¶é•œåƒï¼Œæœ€åº•å±‚çš„é•œåƒç§°ä¹‹ä¸ºåŸºç¡€é•œåƒã€‚æœ€åŽï¼Œå½“ä»Žä¸€ä¸ªé•œåƒå¯åŠ¨å®¹å™¨æ—¶ï¼ŒDockerä¼šåœ¨æœ€é¡¶å±‚åŠ è½½ä¸€ä¸ªè¯»å†™æ–‡ä»¶ç³»ç»Ÿä½œä¸ºå®¹å™¨ã€‚ Dockerçš„è¿™ç§æœºåˆ¶æˆ‘ä»¬ç§°ä¹‹ä¸ºå†™æ—¶å¤åˆ¶ã€‚ æŸ¥çœ‹é•œåƒåˆ—è¡¨ 1docker images è¯¥å‘½ä»¤å¯ä»¥ç”¨äºŽæŸ¥æ‰¾å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰å­˜åœ¨çš„é•œåƒåˆ—è¡¨ã€‚ Psï¼šæœ¬åœ°é•œåƒé»˜è®¤ä¿å­˜åœ¨Dockerå®¿ä¸»æœºçš„/var/lib/dockerç›®å½•ä¸‹ã€‚æ‰€æœ‰çš„é•œåƒéƒ½æ˜¯ä¿å­˜åœ¨ä»“åº“ä¸­ï¼Œè€Œä»“åº“ä½äºŽRegistryä¸­ã€‚é»˜è®¤çš„Registryæ˜¯Dockerå…¬å¸è¿è¥çš„Docker Hubã€‚æ¯ä¸ªé•œåƒä»“åº“éƒ½å¯ä»¥å­˜æ”¾å¾ˆå¤šçš„é•œåƒã€‚ æ‹‰å–é•œåƒ 1docker pull centos ä¸Šè¿°å‘½ä»¤ä¼šæ‹‰å–é•œåƒåˆ°æœ¬åœ°ã€‚ ä¸ºäº†åŒºåˆ†åŒä¸€ä¸ªä»“åº“ä¸­ä¸åŒçš„é•œåƒï¼ŒDockeræä¾›äº†ä¸€ç§tagçš„åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥ç»™æ¯ä¸ªç‰ˆæœ¬çš„é•œåƒæ·»åŠ ä¸€ä¸ªå”¯ä¸€çš„tagæ¥æ ‡è¯†è¯¥é•œåƒã€‚æ­¤æ—¶ï¼Œé•œåƒçš„åç§°å¦‚ä¸‹ï¼šä»“åº“åç§°:tagã€‚æˆ‘ä»¬åœ¨è¿è¡Œé•œåƒæˆ–æ‹‰å–é•œåƒæ—¶ï¼Œå¯ä»¥ç›´æŽ¥æŒ‡å®šå¯¹åº”çš„æ ‡ç­¾ã€‚ 1docker pull registry-vpc.cn-beijing.aliyuncs.com/vcgcs/jdk8:util æŸ¥æ‰¾é•œåƒ ä»ŽDocker HubæŸ¥æ‰¾æœ‰å“ªäº›å…¬å…±çš„å¯ç”¨é•œåƒ 1docker search keywords æž„å»ºDockeré•œåƒ docker build å‘½ä»¤ç”¨äºŽä½¿ç”¨ Dockerfile åˆ›å»ºé•œåƒã€‚ 1docker build -t runoob/ubuntu:v1 . ä½¿ç”¨URL github.com/creack/docker-firefox çš„ Dockerfile åˆ›å»ºé•œåƒã€‚ 1docker build github.com/creack/docker-firefox ä¹Ÿå¯ä»¥é€šè¿‡ -f Dockerfile æ–‡ä»¶çš„ä½ç½®ï¼š 1docker build -f /path/to/a/Dockerfile . ç™»å½•é•œåƒä»“åº“ä½¿ç”¨é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ 1docker login --username="ops@vcg.com" --password="******" registry-vpc.cn-beijing.aliyuncs.com æŽ¨é€é•œåƒåˆ°ä»“åº“1docker push registry-vpc.cn-beijing.aliyuncs.com/vcgcs/jdk8:util ä¿®æ”¹é•œåƒTag12docker images # èŽ·å–ImageIddocker tag [ImageId] registry.cn-beijing.aliyuncs.com/vcg/500px-vcg-com:[é•œåƒç‰ˆæœ¬å·]]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ansible-æ‰¹é‡ä¿®æ”¹å¯†ç ]]></title>
    <url>%2F2019%2F04%2F23%2FAnsible-%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81%2F</url>
    <content type="text"><![CDATA[ä»‹ç»ä½¿ç”¨ansibleæ‰¹é‡ä¿®æ”¹ç”¨æˆ·å¯†ç çš„æ–¹æ³•ï¼Œå› ä¸ºåœ¨ä½¿ç”¨ansibleä¿®æ”¹ç”¨æˆ·å¯†ç çš„æ—¶å€™ä¸èƒ½ä½¿ç”¨æ˜Žæ–‡çš„æ–¹å¼ï¼Œéœ€è¦å…ˆåŠ å¯†ï¼Œæ‰€ä»¥å°±éœ€è¦ä½¿ç”¨ä¸€ä¸ªæ–¹æ³•å¯¹è¾“å…¥çš„æ˜Žæ–‡çš„å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œä¸‹é¢å°±ç›´æŽ¥ä¸Šå¹²è´§ã€‚ æ›´æ”¹å¤šä¸ªå›ºå®šåŸŸå1cat changePasswd.yaml 12345678---- hosts: ops gather_facts: false tasks: - name: change user passwd user: name=&#123;&#123; item.name &#125;&#125; password=&#123;&#123; item.chpass | password_hash('sha512') &#125;&#125; update_password=always with_items: - &#123; name: 'root', chpass: '***********' &#125; 1ansible-playbook changePasswd.yaml]]></content>
      <categories>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é˜¿é‡Œäº‘WAF + Kubernetes Ingress æž¶æž„ä¸‹æ— æ³•æ‹¿åˆ°å®¢æˆ·ç«¯çœŸå®žIPçš„é—®é¢˜å¤„ç†]]></title>
    <url>%2F2019%2F04%2F21%2F%E9%98%BF%E9%87%8C%E4%BA%91WAF-Kubernetes-Ingress-%E6%9E%B6%E6%9E%84%E4%B8%8B%E6%97%A0%E6%B3%95%E6%8B%BF%E5%88%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9C%9F%E5%AE%9EIP%E7%9A%84%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%2F</url>
    <content type="text"><![CDATA[èƒŒæ™¯:2019å¹´04æœˆ19æ—¥æ™š21:10åˆ†è¿›è¡Œç½‘ç»œç»´æŠ¤ï¼Œå†…å®¹å¦‚ä¸‹ï¼š â€‹ å°†åŸŸåCNAMEåˆ°é˜¿é‡Œäº‘çš„Webé˜²ç«å¢™ï¼ˆä»¥ä¸‹ç®€ç§°ä¸ºWAFï¼‰ï¼Œä¸šåŠ¡è¯·æ±‚ç»é˜²ç«å¢™è§£æžåˆ°Kubernetes çš„ Ingress çš„è´Ÿè½½å‡è¡¡ï¼ˆSLBï¼‰åœ°å€ æ•…éšœçŽ°è±¡ï¼šâ€‹ åŽç«¯åº”ç”¨é€šè¿‡èŽ·å–è¯·æ±‚ä¸­çš„X-Forwarded-Forå­—æ®µï¼Œæ‹¿åˆ°çš„IPåœ°å€ä¸ºWAFå›žæºåœ°å€ï¼Œéžå®¢æˆ·ç«¯çœŸå®žIPã€‚ æŽ’æŸ¥è®°å½•: 21:15 æŸ¥çœ‹Ingressæ—¥å¿—ï¼Œå‘çŽ°Ingressæ‹¿åˆ°çš„IPå°±æ˜¯WAFå›žæºåœ°å€ï¼Œä¸ºé”™è¯¯IPï¼Œç¡®å®šéžå‰ç«¯nodejsä»£ç bugã€‚ 21:33 è”ç³»é˜¿é‡Œäº‘æŠ€æœ¯å›¢é˜Ÿä¸€èµ·æŽ’æŸ¥é—®é¢˜ã€‚ 22:20 ç¡®è®¤Ingressçš„æ¨¡æ¿æ–‡ä»¶ä¸­ the_real_ip å˜é‡æ˜¯æ‹¿çš„ remote_addr å­—æ®µï¼Œç­‰å¾…é˜¿é‡ŒæŠ€æœ¯è”ç³»Ingreeç ”å‘åŒå­¦ï¼Œç»™å‡ºå›žå¤ã€‚ 23:23 Ingreeç ”å‘åŒå­¦è”ç³»ä¸ŠåŽç¡®è®¤Ingressæ²¡é—®é¢˜ï¼Œå¯èƒ½æ˜¯WAFæ²¡ä¼ çœŸå®žIPåˆ°Ingressã€‚ 23:50 åœ¨Ingresså®¹å™¨å’Œå‰ç«¯nodejsæ‰€åœ¨å®¿ä¸»æœºtcpdumpå·¥å…·æŠ“åŒ…åŽåˆ†æžå¾—å‡ºï¼š (1)ã€WAFå·²ç»å°†çœŸå®žå®¢æˆ·ç«¯åœ°å€æ”¾åˆ°äº† x-Forwarded-For çš„å­—æ®µä¸­ä¼ ç»™äº†ECS(2)ã€ECS(å®¹å™¨çš„ingress)å°†çœŸå®žçš„å®¢æˆ·ç«¯IPï¼Œæ”¾åˆ°äº†x-Original-Forwarded-Forï¼›è€Œå°†WAFçš„å›žæºåœ°å€æ”¾åˆ°äº† x-Forwarded-For 4æœˆ20æ—¥ 00:29 å°†compute-full-forwarded-foré…ç½®åˆ°Ingressçš„ConfigMapä¸­ï¼Œé—®é¢˜è§£å†³ã€‚ æ“ä½œï¼š1kubectl -n kube-system edit cm nginx-configuration 1234åœ¨dataæ ‡ç­¾ä¸‹æ·»åŠ å¦‚ä¸‹ï¼šcompute-full-forwarded-for: &quot;true&quot;forwarded-for-header: &quot;X-Forwarded-For&quot;use-forwarded-headers: &quot;true&quot; ç»“è®ºï¼šé˜¿é‡Œäº‘å®¹å™¨æœåŠ¡Kubernetesé›†ç¾¤çš„Ingressé»˜è®¤ConfigMapä¸­æœªé…ç½® compute-full-forwarded-forå‚æ•°ï¼Œå¯¼è‡´å°†ingressæ‹¿åˆ°çš„WAFå›žæºIPæ›¿æ¢ä¸ºXFFï¼Œè€Œéžé™„åŠ åˆ°XFFä¸­ã€‚ https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap/#compute-full-forwarded-for åæ€ï¼š é¢„è§ˆçŽ¯å¢ƒå’Œçº¿ä¸ŠçŽ¯å¢ƒæž¶æž„ä¸ä¸€è‡´ï¼š æ­¤æ¬¡æ•…éšœä¸­ï¼Œé¢„è§ˆçŽ¯å¢ƒæœªä½¿ç”¨WAFé˜²æŠ¤ï¼Œç›´æŽ¥è§£æžåˆ°K8Sé›†ç¾¤ï¼Œæœªæå‰å‘çŽ°æ­¤æ¬¡é—®é¢˜ï¼Œå·²ä¿®æ­£ï¼Œä»¥åŽå°½é‡ç»´æŒçŽ¯å¢ƒç»Ÿä¸€ï¼Œé¿å…æ­¤ç±»é—®é¢˜å‡ºçŽ°ã€‚ æ•…éšœç‚¹å®šä½é€Ÿåº¦æ…¢ï¼š ç½‘ç»œè¯·æ±‚é—®é¢˜ä¼˜å…ˆæŠ“åŒ…åˆ†æžï¼Œæå‡æ•…éšœå®šä½é€Ÿåº¦ï¼ŒåŽç»­å¤¯å®žåŸºç¡€çŸ¥è¯†ï¼Œæå‡é—®é¢˜æŽ’æŸ¥èƒ½åŠ›ã€‚ Kubernetesä¸“ä¸šçŸ¥è¯†æŽŒæ¡ç¨‹åº¦è¾ƒä½Ž ç›®å‰ä»…ä»…åœ¨ä½¿ç”¨å±‚é¢ä¸Šèƒ½åŠ›okï¼Œä½†æ˜¯å…¶å®žçŽ°åŽŸç†ã€ç»„ä»¶å®žçŽ°æ–¹å¼ç­‰çŸ¥è¯†ç‚¹è–„å¼±ï¼ŒåŽç»­è¿˜éœ€åœ¨K8Så­¦ä¹ ä¸­å¤šæ€»ç»“ï¼Œå¤šå­¦ä¹ ï¼Œäº‰å–å‡å°‘æ•…éšœï¼Œæå‡è¿ç»´èƒ½åŠ›ã€‚]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Kubernetes-kubectl]]></title>
    <url>%2F2019%2F04%2F21%2FKubernetes-kubectl%2F</url>
    <content type="text"><![CDATA[ç®¡ç†Kubernetesé›†ç¾¤çš„å·¥å…· å®‰è£… ä¸‹è½½æœ€æ–°ç‰ˆçš„kubectlå®¢æˆ·ç«¯https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG.md&gt; å®‰è£…å’Œé…ç½®https://kubernetes.io/docs/tasks/tools/install-kubectl/&gt; éªŒè¯å®‰è£… 1kuberctl version é…ç½®é›†ç¾¤å‡­è¯æ‚¨å¯ä»¥ä½¿ç”¨scpå‘½ä»¤å®‰å…¨åœ°å°†ä¸»èŠ‚ç‚¹çš„é…ç½®ä»Ž Kubernetes é›†ç¾¤ä¸» VM ä¸­çš„ /etc/kubernetes/kube.conf å¤åˆ¶åˆ°æœ¬åœ°è®¡ç®—æœºçš„ $HOME/.kube/configï¼ˆkubectl é¢„æœŸå‡­æ®æ‰€åœ¨çš„ä½ç½®ï¼‰ã€‚ 12mkdir $HOME/.kubescp root@&lt;master-public-ip&gt;:/etc/kubernetes/kube.conf $HOME/.kube/config å…¬æœ‰äº‘çŽ¯å¢ƒä¹Ÿå¯ä»¥åœ¨é›†ç¾¤é…ç½®é¡µé¢èŽ·å–åˆ°configé…ç½® éªŒè¯è¿žæŽ¥ 1kubect get all å‘½ä»¤å‚æ•°help-èŽ·å–å¸®åŠ©ä¿¡æ¯123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475zhaohongye ~ ^-^ #kubectl helpkubectl controls the Kubernetes cluster manager.Find more information at: https://kubernetes.io/docs/reference/kubectl/overview/Basic Commands (Beginner): create Create a resource from a file or from stdin. expose ä½¿ç”¨ replication controller, service, deployment æˆ–è€… podå¹¶æš´éœ²å®ƒä½œä¸ºä¸€ä¸ª æ–°çš„ Kubernetes Service run åœ¨é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„é•œåƒ set ä¸º objects è®¾ç½®ä¸€ä¸ªæŒ‡å®šçš„ç‰¹å¾ run-container åœ¨é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„é•œåƒ. This command isdeprecated, use "run" insteadBasic Commands (Intermediate): get æ˜¾ç¤ºä¸€ä¸ªæˆ–æ›´å¤š resources explain æŸ¥çœ‹èµ„æºçš„æ–‡æ¡£ edit åœ¨æœåŠ¡å™¨ä¸Šç¼–è¾‘ä¸€ä¸ªèµ„æº delete Delete resources by filenames, stdin, resources and names, orby resources and label selectorDeploy Commands: rollout Manage the rollout of a resource rolling-update å®ŒæˆæŒ‡å®šçš„ ReplicationController çš„æ»šåŠ¨å‡çº§ scale ä¸º Deployment, ReplicaSet, Replication Controller æˆ–è€… Jobè®¾ç½®ä¸€ä¸ªæ–°çš„å‰¯æœ¬æ•°é‡ autoscale è‡ªåŠ¨è°ƒæ•´ä¸€ä¸ª Deployment, ReplicaSet, æˆ–è€…ReplicationController çš„å‰¯æœ¬æ•°é‡Cluster Management Commands: certificate ä¿®æ”¹ certificate èµ„æº. cluster-info æ˜¾ç¤ºé›†ç¾¤ä¿¡æ¯ top Display Resource (CPU/Memory/Storage) usage. cordon æ ‡è®° node ä¸º unschedulable uncordon æ ‡è®° node ä¸º schedulable drain Drain node in preparation for maintenance taint æ›´æ–°ä¸€ä¸ªæˆ–è€…å¤šä¸ª node ä¸Šçš„ taintsTroubleshooting and Debugging Commands: describe æ˜¾ç¤ºä¸€ä¸ªæŒ‡å®š resource æˆ–è€… group çš„ resources è¯¦æƒ… logs è¾“å‡ºå®¹å™¨åœ¨ pod ä¸­çš„æ—¥å¿— attach Attach åˆ°ä¸€ä¸ªè¿è¡Œä¸­çš„ container exec åœ¨ä¸€ä¸ª container ä¸­æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ port-forward Forward one or more local ports to a pod proxy è¿è¡Œä¸€ä¸ª proxy åˆ° Kubernetes API server cp å¤åˆ¶ files å’Œ directories åˆ° containerså’Œä»Žå®¹å™¨ä¸­å¤åˆ¶ files å’Œ directories. auth Inspect authorizationAdvanced Commands: apply é€šè¿‡æ–‡ä»¶åæˆ–æ ‡å‡†è¾“å…¥æµ(stdin)å¯¹èµ„æºè¿›è¡Œé…ç½® patch ä½¿ç”¨ strategic merge patch æ›´æ–°ä¸€ä¸ªèµ„æºçš„ field(s) replace é€šè¿‡ filename æˆ–è€… stdinæ›¿æ¢ä¸€ä¸ªèµ„æº convert åœ¨ä¸åŒçš„ API versions è½¬æ¢é…ç½®æ–‡ä»¶Settings Commands: label æ›´æ–°åœ¨è¿™ä¸ªèµ„æºä¸Šçš„ labels annotate æ›´æ–°ä¸€ä¸ªèµ„æºçš„æ³¨è§£ completion Output shell completion code for the specified shell (bash orzsh)Other Commands: api-versions Print the supported API versions on the server, in the form of"group/version" config ä¿®æ”¹ kubeconfig æ–‡ä»¶ help Help about any command plugin Runs a command-line plugin version è¾“å‡º client å’Œ server çš„ç‰ˆæœ¬ä¿¡æ¯Usage: kubectl [flags] [options]Use "kubectl &lt;command&gt; --help" for more information about a given command.Use "kubectl options" for a list of global command-line options (applies to allcommands). get-èŽ·å–ä¿¡æ¯Display one or many resources 123456789101112131415161718192021222324252627Examples: # List all pods in ps output format. kubectl get pods # List all pods in ps output format with more information (such as node name). kubectl get pods -o wide # List a single replication controller with specified NAME in ps output format. kubectl get replicationcontroller web # List a single pod in JSON output format. kubectl get -o json pod web-pod-13je7 # List a pod identified by type and name specified in "pod.yaml" in JSON output format. kubectl get -f pod.yaml -o json # Return only the phase value of the specified pod. kubectl get -o template pod/web-pod-13je7 --template=&#123;&#123;.status.phase&#125;&#125; # List all replication controllers and services together in ps output format. kubectl get rc,services # List one or more resources by their type and names. kubectl get rc/web service/frontend pods/web-pod-13je7 # List all resources with different types. kubectl get all scale-æ‰©ç¼©å®¹Set a new size for a Deployment, ReplicaSet, Replication Controller, or StatefulSet. 123456789101112131415161718Examples: # Scale a replicaset named &apos;foo&apos; to 3. kubectl scale --replicas=3 rs/foo # Scale a resource identified by type and name specified in &quot;foo.yaml&quot; to 3. kubectl scale --replicas=3 -f foo.yaml # If the deployment named mysql&apos;s current size is 2, scale mysql to 3. kubectl scale --current-replicas=2 --replicas=3 deployment/mysql # Scale multiple replication controllers. kubectl scale --replicas=5 rc/foo rc/bar rc/baz # Scale statefulset named &apos;web&apos; to 3. kubectl scale --replicas=3 statefulset/web kubectl scale Deployment node-vcg-web --replicas=1 kubectl scale Deployment node-vcg-web --replicas=10 æ‰¹é‡æ‰©ç¼©å®¹ 123for i in `kubectl get deployment | awk '&#123;print $1&#125;' |grep -v NAME`; do kubectl scale Deployment $i --replicas=1done exec-åœ¨containerä¸­æ‰§è¡Œå‘½ä»¤Execute a command in a container. 123456789Options: -c, --container='': Container name. If omitted, the first container in the pod will be chosen -p, --pod='': Pod name -i, --stdin=false: Pass stdin to the container -t, --tty=false: Stdin is a TTYExamples: kubectl exec 123456-7890 -c ruby-container -it -- bash -ilUsage: kubectl exec POD [-c CONTAINER] -- COMMAND [args...] [options]]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hexo-åšå®¢ä¸­æ·»åŠ å›¾ç‰‡ç­‰èµ„æº]]></title>
    <url>%2F2019%2F04%2F21%2FHexo-%E5%8D%9A%E5%AE%A2%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%9B%BE%E7%89%87%E7%AD%89%E8%B5%84%E6%BA%90%2F</url>
    <content type="text"><![CDATA[å¼•ç”¨äºŽ https://blog.csdn.net/qq_40265501/article/details/80019774 å®˜æ–¹ä»‹ç»ï¼šhttps://hexo.io/zh-cn/docs/asset-folders.html ä¸€å›¾èƒœä¸‡è¨€ åšå®¢ä¸­æœ‰æ—¶å€™å›¾ç‰‡æ¯”æ–‡å­—æ›´æœ‰è¯´æœåŠ›ï¼Œæ¯”å¦‚ï¼šä»£ç è¿è¡Œç»“æžœï¼Œä»£ç è¿è¡Œæ•ˆæžœç­‰ å¼€å¯â€™èµ„æºæ–‡ä»¶ç®¡ç†â€™åŠŸèƒ½å°† config.ymlæ–‡ä»¶ä¸­çš„ post_asset_folder é€‰é¡¹è®¾ä¸º true 12_config.ymlpost_asset_folder: true å®‰è£…Hexoæ’ä»¶æ’ä»¶åœ°å€ï¼šhttps://github.com/dangxuandev/hexo-asset-image 1npm install hexo-asset-image --save åœ¨åšå®¢ä¸­æ·»åŠ å›¾ç‰‡ æ–°å»ºåšå®¢ 1hexo n test æŸ¥çœ‹ç›®å½•ç»“æž„ 123[root@nginx GeekSRE]# ls -l source/_posts/ |grep testdrwxr-xr-x 2 root root 4096 4æœˆ 17 17:29 test-rw-r--r-- 1 root root 96 4æœˆ 17 17:35 test.md å¯ä»¥çœ‹åˆ° ä¼šåœ¨ source/_posts ç›®å½•åˆ›å»º test.md å’Œ testç›®å½• ä¸Žåšå®¢åŒåç›®å½•ç”¨äºŽå­˜æ”¾èµ„æºæ–‡ä»¶ï¼Œå¦‚å›¾ç‰‡ã€CSSã€JS æ–‡ä»¶ç­‰ ä¸Šä¼ å›¾ç‰‡åˆ°â€æ–‡ç« èµ„æºæ–‡ä»¶å¤¹â€ 123# æ¯”å¦‚ä½¿ç”¨CSDNåšå®¢ä¸­çš„å›¾ç‰‡ï¼šcd source/_posts/testwget https://img-blog.csdn.net/20180420154609543 å¼•ç”¨ 12345vim source/_posts/test.md# ![ä½ æƒ³è¦è¾“å…¥çš„æ›¿ä»£æ–‡å­—](å›¾ç‰‡æ–‡ä»¶)# æ¯”å¦‚ï¼š![å›¾ç‰‡](test.jpg) ä¿å­˜ 1hexo clean &amp;&amp; hexo g &amp;&amp; hexo d éªŒè¯æ•ˆæžœ]]></content>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[GitLabä»£ç æ‰˜ç®¡]]></title>
    <url>%2F2019%2F04%2F16%2FGitLab%E4%BB%A3%E7%A0%81%E6%89%98%E7%AE%A1%2F</url>
    <content type="text"><![CDATA[GitLab æ˜¯ä¸€ä¸ªç”¨äºŽä»“åº“ç®¡ç†ç³»ç»Ÿçš„å¼€æºé¡¹ç›®ï¼Œä½¿ç”¨Gitä½œä¸ºä»£ç ç®¡ç†å·¥å…·ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šæ­å»ºèµ·æ¥çš„webæœåŠ¡ã€‚ å®˜ç½‘ï¼šhttps://about.gitlab.com/stages-devops-lifecycle/ å®‰è£…é…ç½®Yumæº123456vim /etc/yum.repos.d/gitlab_gitlab-ee.repo[gitlab-ce]name=Gitlab CE Repositorybaseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el$releasever/gpgcheck=0enabled=1 å®‰è£…12yum install -y postfixyum install gitlab-ce -y é…ç½®é…ç½®æ–‡ä»¶ï¼š/etc/gitlab/gitlab.rb (å»ºè®®æ¯æ¬¡ä¿®æ”¹å‰å¤‡ä»½æ­¤æ–‡ä»¶) 1234567891011121314151617181920212223242526272829 external_url 'https://git.visualchina.com' # åŸŸåé…ç½® gitlab_rails['time_zone'] = 'Asia/Shanghai' # æ—¶åŒº nginx['redirect_http_to_https'] = true # SSLè¯ä¹¦ nginx['ssl_certificate'] = "/data/vcg/ssl/visualchina.pem" nginx['ssl_certificate_key'] = "/data/vcg/ssl/visualchina.key" gitlab_rails['ldap_enabled'] = truegitlab_rails['ldap_servers'] = YAML.load &lt;&lt;-'EOS' # remember to close this block with 'EOS' below main: # 'main' is the GitLab 'provider ID' of this LDAP server label: 'LDAP' host: '172.16.239.3' port: 389 uid: 'cn' method: 'plain' # "tls" or "ssl" or "plain" bind_dn: 'cn=root,dc=vcg,dc=com' password: 'vcg@2018' active_directory: true allow_username_or_email_login: false block_auto_created_users: false base: 'ou=People,dc=vcg,dc=com' user_filter: '' attributes: username: ['cn'] email: ['mail'] name: 'cn' first_name: 'givenName' last_name: 'sn'EOS é…ç½®å®ŒæˆåŽè¿›è¡Œé…ç½®æ›´æ–°1gitlab-ctl reconfigure æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸ1gitlab-rake gitlab:ldap:checkï¼ˆåˆ—å‡ºå‰100ä¸ªç”¨æˆ·ï¼‰ é‡å¯gitlabæœåŠ¡1gitlab-ctl restart è®¿é—®è®¿é—®ip:80ç«¯å£ é…ç½®rootå¯†ç ï¼Œè‡³æ­¤éƒ¨ç½²å®Œæˆã€‚ å‡çº§å‡çº§è§„èŒƒå’Œå»ºè®®https://docs.gitlab.com/ee/policy/maintenance.html#upgrade-recommendations é¦–å…ˆå‡çº§åˆ°ä¸»è¦ç‰ˆæœ¬ä¸­çš„æœ€æ–°å¯ç”¨æ¬¡è¦ç‰ˆæœ¬ ä¾‹å¦‚ï¼š8.13.4 å‡çº§åˆ° 11.3.4 ï¼Œå‡çº§è·¯å¾„ä¸º 8.13.4 -&gt; 8.17.7 -&gt; 9.5.10 -&gt; 10.8.7 -&gt; 11.3.4 â€‹ å³ï¼š8.17.7æ˜¯ç‰ˆæœ¬8ä¸­çš„æœ€åŽä¸€ä¸ªç‰ˆæœ¬, 9.5.10æ˜¯ç‰ˆæœ¬9ä¸­çš„æœ€åŽä¸€ä¸ªç‰ˆæœ¬, 10.8.7æ˜¯ç‰ˆæœ¬10ä¸­çš„æœ€åŽä¸€ä¸ªç‰ˆæœ¬ å‡çº§æ“ä½œæœ¬æ¬¡å‡çº§ç‰ˆæœ¬ä¸º 10.7.0 ï¼Œå‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ 11.9.8 ï¼Œæ³¨ï¼š2019å¹´04æœˆ16æ—¥ 1ã€ä¸‹è½½10.8.7ç‰ˆæœ¬çš„rpmåŒ…1wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-10.8.7-ce.0.el7.x86_64.rpm 2ã€å®‰è£…å‡çº§åˆ°10.8.7ç‰ˆæœ¬1rpm -Uvh gitlab-ce-10.8.7-ce.0.el7.x86_64.rpm 3ã€å†å‡çº§åˆ°11.9.8ç‰ˆæœ¬1yum install gitlab-ce.x86_64 è¿ç§»å¤‡ä»½æºGitLabæ•°æ®12345gitlab-rake gitlab:backup:create RAILS_ENV=production# Creating backup archive: 1555983152_2019_04_23_11.9.8_gitlab_backup.tar ...# æ•°æ®ä¿å­˜åœ¨ /var/opt/gitlab/backupsï¼Œè‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶åï¼Œæ¯”å¦‚æœ¬æ¬¡çš„ 1555983152_2019_04_23_11.9.8_gitlab_backup.tar SCPè¿ç§»æ•°æ®12#æŒ‰éœ€æ›¿æ¢ç›®æ ‡åœ°å€scp /var/opt/gitlab/backups/1555983152_2019_04_23_11.9.8_gitlab_backup.tar root@1.1.1.1:/root/var/opt/gitlab/backups å®‰è£…GitLabè¯·å‚è€ƒ å®‰è£… ç« èŠ‚ æ¢å¤æ•°æ®12gitlab-rake gitlab:backup:restore RAILS_ENV=production BACKUP=1555983152_2019_04_23_11.9.8# BACKUPçš„æ—¶é—´ç‚¹å¿…é¡»ä¸ŽåŽŸæœåŠ¡å™¨å¤‡ä»½åŽçš„æ–‡ä»¶åä¸€è‡´ ç»´æŠ¤å®šæœŸå¤‡ä»½1234crontab -l0 14 * * * /usr/bin/gitlab-rake gitlab:backup:create0 15 * * * find /var/opt/gitlab/backups/* -type f -mtime +3 -exec rm &#123;&#125; \; gitlab-ctlå‘½ä»¤123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869[root@iZ2ze4cng635a2k047qus5Z ~]# gitlab-ctl --helpomnibus-ctl: command (subcommand)check-config Check if there are any configuration in gitlab.rb that is removed in specified versiondeploy-page Put up the deploy pagediff-config Compare the user configuration with package available configurationprometheus-upgrade Upgrade the Prometheus data to the latest supported versionremove-accounts Delete *all* users and groups used by this packageupgrade Run migrations after a package upgradeGeneral Commands: cleanse Delete *all* gitlab data, and start from scratch. help Print this help message. reconfigure Reconfigure the application. show-config Show the configuration that would be generated by reconfigure. uninstall Kill all processes and uninstall the process supervisor (data will be preserved).Service Management Commands: graceful-kill Attempt a graceful stop, then SIGKILL the entire process group. hup Send the services a HUP. int Send the services an INT. kill Send the services a KILL. once Start the services if they are down. Do not restart them if they stop. restart Stop the services if they are running, then start them again. service-list List all the services (enabled services appear with a *.) start Start services if they are down, and restart them if they stop. status Show the status of all the services. stop Stop the services, and do not restart them. tail Watch the service logs of all enabled services. term Send the services a TERM. usr1 Send the services a USR1. usr2 Send the services a USR2.Container Registry Commands: registry-garbage-collect Run Container Registry garbage collection.Database Commands: pg-password-md5 Generate MD5 Hash of user password in PostgreSQL format pg-upgrade Upgrade the PostgreSQL DB to the latest supported version revert-pg-upgrade Run this to revert to the previous version of the database set-replication-password Set database replication passwordLet's Encrypt Commands: renew-le-certs Renew the existing Let's Encrypt certificates]]></content>
      <categories>
        <category>GitLab</category>
      </categories>
      <tags>
        <tag>GitLab</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŸŸåSSLè¯ä¹¦]]></title>
    <url>%2F2019%2F04%2F16%2F%E5%9F%9F%E5%90%8DSSL%E8%AF%81%E4%B9%A6%2F</url>
    <content type="text"><![CDATA[SSLè¯ä¹¦ ä»€ä¹ˆæ˜¯æ•°å­—è¯ä¹¦ï¼Ÿ æ•°å­—è¯ä¹¦æ˜¯ä¸€ä¸ªç»æƒå¨æŽˆæƒæœºæž„æ•°å­—ç­¾åã€åŒ…å«å…¬å¼€å¯†é’¥æ‹¥æœ‰è€…ä¿¡æ¯ä»¥åŠå…¬å¼€å¯†é’¥çš„æ–‡ä»¶ï¼Œæ˜¯æƒå¨æœºæž„é¢å‘ç»™ç½‘ç«™çš„å¯ä¿¡å‡­è¯ã€‚æœ€ç®€å•çš„è¯ä¹¦åŒ…å«ä¸€ä¸ªå…¬å¼€å¯†é’¥ã€è¯ä¹¦åç§°ä»¥åŠè¯ä¹¦æŽˆæƒä¸­å¿ƒçš„æ•°å­—ç­¾åã€‚ æ•°å­—è¯ä¹¦è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç‰¹å¾ï¼šåªåœ¨ç‰¹å®šçš„æ—¶é—´æ®µå†…æœ‰æ•ˆã€‚ ä»€ä¹ˆæ˜¯SSLï¼Ÿ SSLåè®®æ˜¯ä¸€ç§å¯å®žçŽ°ç½‘ç»œé€šä¿¡åŠ å¯†çš„å®‰å…¨åè®®ï¼Œå¯åœ¨æµè§ˆå™¨å’Œç½‘ç«™ä¹‹é—´å»ºç«‹åŠ å¯†é€šé“ï¼Œä¿éšœæ•°æ®åœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­ä¸è¢«ç¯¡æ”¹æˆ–çªƒå–ã€‚ ä»€ä¹ˆæ˜¯SSLè¯ä¹¦ï¼Ÿ SSLè¯ä¹¦é‡‡ç”¨SSLåè®®è¿›è¡Œé€šä¿¡ï¼Œæ˜¯ç”±æƒå¨æœºæž„é¢å‘ç»™ç½‘ç«™çš„å¯ä¿¡å‡­è¯ã€‚ SSLè¯ä¹¦é‡‡ç”¨SSLåè®®è¿›è¡Œé€šä¿¡ã€‚SSLè¯ä¹¦éƒ¨ç½²åˆ°WebæœåŠ¡å™¨åŽï¼ŒWebæœåŠ¡å™¨è®¿é—®å°†å¯ç”¨HTTPSåè®®ã€‚æ‚¨çš„ç½‘ç«™å°†ä¼šé€šè¿‡ HTTPS åŠ å¯†åè®®æ¥ä¼ è¾“æ•°æ®ï¼Œå¯å¸®åŠ©WebæœåŠ¡å™¨å’Œç½‘ç«™é—´å»ºç«‹å¯ä¿¡çš„åŠ å¯†é“¾æŽ¥ï¼Œä»Žè€Œä¿è¯ç½‘ç»œæ•°æ®ä¼ è¾“çš„å®‰å…¨ã€‚ ä»€ä¹ˆæ˜¯HTTPSï¼Ÿ HTTPSæ˜¯ä¸€ç§åŸºäºŽSSLåè®®çš„ç½‘ç«™åŠ å¯†ä¼ è¾“åè®®ã€‚ ç½‘ç«™å®‰è£…SSLè¯ä¹¦åŽï¼Œä½¿ç”¨HTTPSåŠ å¯†åè®®è®¿é—®ï¼Œå¯æ¿€æ´»å®¢æˆ·ç«¯æµè§ˆå™¨åˆ°ç½‘ç«™æœåŠ¡å™¨ä¹‹é—´çš„SSLåŠ å¯†é€šé“ï¼ˆSSLåè®®ï¼‰ï¼Œä»Žè€Œå®žçŽ°é«˜å¼ºåº¦åŒå‘åŠ å¯†ä¼ è¾“ï¼Œé˜²æ­¢ä¼ è¾“æ•°æ®è¢«æ³„éœ²æˆ–ç¯¡æ”¹ã€‚HTTPS ä¹Ÿå°±æ˜¯HTTP + SSLï¼Œæ˜¯HTTPçš„å®‰å…¨ç‰ˆã€‚ ä»€ä¹ˆæ˜¯CAè®¤è¯ä¸­å¿ƒï¼Ÿ CAè®¤è¯ä¸­å¿ƒï¼ˆCAæœºæž„ï¼‰ï¼Œå³è¯ä¹¦æŽˆæƒä¸­å¿ƒï¼ˆCertificate Authorityï¼‰ï¼Œæˆ–ç§°è¯ä¹¦æŽˆæƒæœºæž„ã€‚ CAè®¤è¯ä¸­å¿ƒä½œä¸ºç”µå­å•†åŠ¡äº¤æ˜“ä¸­å—ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹ï¼Œæ‰¿æ‹…å…¬é’¥ä½“ç³»ä¸­å…¬é’¥åˆæ³•æ€§æ£€éªŒçš„è´£ä»»ã€‚ SSLè¯ä¹¦ç±»åž‹é…ç½®è¡¨è¯ä¹¦æ ¹æ®ä¸åŒçš„éªŒè¯çº§åˆ«ï¼Œåˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š åŸŸååž‹SSLï¼ˆDV SSLï¼‰ ä¼ä¸šåž‹SSLï¼ˆOV SSLï¼‰ å¢žå¼ºåž‹SSLï¼ˆEV SSLï¼‰ æ ¹æ®ä¿æŠ¤åŸŸåçš„æ•°é‡éœ€æ±‚ï¼ŒSSL è¯ä¹¦åˆåˆ†ä¸ºï¼š å•åŸŸåç‰ˆï¼šåªä¿æŠ¤ä¸€ä¸ªåŸŸåï¼Œä¾‹å¦‚ www.abc.com æˆ–è€… login.abc.com ä¹‹ç±»çš„å•ä¸ªåŸŸå å¤šåŸŸåç‰ˆï¼šä¸€å¼ è¯ä¹¦å¯ä»¥ä¿æŠ¤å¤šä¸ªåŸŸåï¼Œä¾‹å¦‚åŒæ—¶ä¿æŠ¤ www.abc.com , www.bcd.com, pay.efg.com ç­‰ é€šé…ç¬¦ç‰ˆï¼šä¸€å¼ è¯ä¹¦ä¿æŠ¤åŒä¸€ä¸ªä¸»åŸŸåä¸‹åŒä¸€çº§çš„æ‰€æœ‰å­åŸŸåï¼Œä¸é™ä¸ªæ•°ï¼Œå½¢å¦‚ *.abc.com ã€‚æ³¨æ„ï¼Œé€šé…ç¬¦ç‰ˆåªæœ‰ DVSSL å’Œ OVSSL å…·æœ‰ï¼Œ EVSSL ä¸å…·æœ‰é€šé…ç¬¦ç‰ˆæœ¬ã€‚ è¯ä¹¦å“ç‰Œ è¯ä¹¦ç±»åž‹ ä¿æŠ¤åŸŸåçš„ç±»åž‹ è¯´æ˜Ž GeoTrust ä¸“ä¸šç‰ˆOV SSL 1ä¸ªå¸¦é€šé…ç¬¦çš„åŸŸå1ä¸ªæ˜Žç»†åŸŸåå¤šä¸ªæ˜Žç»†åŸŸå æä¾›åŠ å¯†åŠŸèƒ½ï¼Œå¯¹ç”³è¯·è€…çš„èº«ä»½è¿›è¡Œä¸¥æ ¼çš„å®¡æ ¸éªŒè¯ï¼Œå¯æä¾›å¯ä¿¡èº«ä»½è¯æ˜Žã€‚å¤šä¸ªåŸŸåä¾‹ä¸Šé™ä¸º300ä¸ªã€‚å¦‚: buy1.example.com, buy2.example.com, next.buy.example2.com, ä¸Šè¿°3ä¸ªæ˜Žç»†å­åŸŸåè®¡ç®—ä¸º3ä¸ªåŸŸåã€‚ é«˜çº§ç‰ˆEV SSL 1ä¸ªåŸŸåå¤šä¸ªåŸŸå æä¾›åŠ å¯†åŠŸèƒ½ï¼Œå¯¹ç”³è¯·è€…åšæœ€ä¸¥æ ¼çš„èº«ä»½å®¡æ ¸éªŒè¯ï¼Œæä¾›æœ€é«˜åº¦å¯ä¿¡èº«ä»½è¯æ˜Žï¼Œæä¾›æµè§ˆå™¨ç»¿è‰²åœ°å€æ ã€‚ GlobalSign ä¸“ä¸šç‰ˆOV SSL é€šé…ç¬¦åŸŸå æä¾›åŠ å¯†åŠŸèƒ½ï¼Œå¯¹ç”³è¯·è€…è¿›è¡Œä¸¥æ ¼çš„èº«ä»½å®¡æ ¸éªŒè¯ï¼Œæä¾›å¯ä¿¡èº«ä»½è¯æ˜Žã€‚ CFCA ä¸“ä¸šç‰ˆOV SSL é€šé…ç¬¦åŸŸå1ä¸ªåŸŸåå¤šä¸ªåŸŸå æä¾›åŠ å¯†åŠŸèƒ½ï¼Œå¯¹ç”³è¯·è€…è¿›è¡Œä¸¥æ ¼çš„èº«ä»½å®¡æ ¸éªŒè¯ï¼Œæä¾›å¯ä¿¡èº«ä»½è¯æ˜Žã€‚ é«˜çº§ç‰ˆEV SSL 1ä¸ªåŸŸåå¤šä¸ªåŸŸå æä¾›åŠ å¯†åŠŸèƒ½ï¼Œå¯¹ç”³è¯·è€…åšæœ€ä¸¥æ ¼çš„èº«ä»½å®¡æ ¸éªŒè¯ï¼Œæä¾›æœ€é«˜åº¦å¯ä¿¡èº«ä»½è¯æ˜Žï¼Œæä¾›æµè§ˆå™¨ç»¿è‰²åœ°å€æ ã€‚ Symantec ä¸“ä¸šç‰ˆOV SSL é€šé…ç¬¦åŸŸå1ä¸ªåŸŸåå¤šä¸ªåŸŸå æä¾›åŠ å¯†åŠŸèƒ½ï¼Œå¯¹ç”³è¯·è€…è¿›è¡Œä¸¥æ ¼çš„èº«ä»½å®¡æ ¸éªŒè¯ï¼Œæä¾›å¯ä¿¡èº«ä»½è¯æ˜Žã€‚ é€šé…ç¬¦DV SSL é€šé…ç¬¦åŸŸå å¢žå¼ºåž‹OV SSL 1ä¸ªåŸŸåå¤šä¸ªåŸŸå æä¾›ç«™ç‚¹åŠ å¯†åŠŸèƒ½ï¼Œéœ€è¦æ ¸éªŒç»„ç»‡æ³¨å†Œä¿¡æ¯ï¼Œè¯ä¹¦ä¸­ä¼šæ˜¾ç¤ºç»„ç»‡åç§°ã€‚ç»„ç»‡ä¿¡æ¯éªŒè¯é€šè¿‡åŽï¼Œ3ä¸ªå·¥ä½œæ—¥å†…é¢å‘è¯ä¹¦ã€‚ é«˜çº§ç‰ˆEV SSL 1ä¸ªåŸŸåå¤šä¸ªåŸŸå æä¾›åŠ å¯†åŠŸèƒ½ï¼Œå¯¹ç”³è¯·è€…åšæœ€ä¸¥æ ¼çš„èº«ä»½å®¡æ ¸éªŒè¯ï¼Œæä¾›æœ€é«˜åº¦å¯ä¿¡èº«ä»½è¯æ˜Žï¼Œæä¾›æµè§ˆå™¨ç»¿è‰²åœ°å€æ ã€‚ å¢žå¼ºåž‹EV SSL 1ä¸ªåŸŸåå¤šä¸ªåŸŸå å¢žå¼ºåž‹EV SSLæä¾›ç«™ç‚¹åŠ å¯†åŠŸèƒ½ï¼Œæµè§ˆå™¨ç»¿è‰²åœ°å€æ æ˜¾ç¤ºç»„ç»‡ä¿¡æ¯å¼ºåŒ–ä¿¡ä»»ã€‚ç»„ç»‡ä¿¡æ¯éªŒè¯é€šè¿‡åŽ7ä¸ªå·¥ä½œæ—¥å†…é¢å‘è¯ä¹¦ã€‚ å…è´¹åž‹DV SSL 1ä¸ªåŸŸå å…è´¹æ–°æ ¹è¯ä¹¦ï¼Œåˆ‡å…¥DigiCert PKIä½“ç³»ï¼Œå…¼å®¹æ€§æ“ä½œç³»ç»Ÿç‰ˆæœ¬IOS 5.0+ã€Android 2.3.3+ã€JRE 1.6.5+ã€WIN 7+ã€‚æœ€å¤šä¿æŠ¤ä¸€ä¸ªæ˜Žç»†å­åŸŸåï¼Œä¸æ”¯æŒé€šé…ç¬¦ï¼Œä¸€ä¸ªé˜¿é‡Œäº‘å¸æˆ·æœ€å¤šç­¾å‘20å¼ å…è´¹è¯ä¹¦ã€‚ SSLè¯ä¹¦è´­ä¹°ç™»å½•é˜¿é‡Œäº‘æŽ§åˆ¶å°ï¼Œè¿›å…¥SSLè¯ä¹¦æœåŠ¡ã€‚ SSLè¯ä¹¦æ›´æ–°å…¬å¸åŸŸåSSLè¯ä¹¦å³å°†åˆ°æœŸï¼Œæ›¿æ¢SSLè¯ä¹¦éœ€çŸ¥é“å“ªäº›äºŒçº§åŸŸåä½¿ç”¨äº†HTTPSè®¿é—®ï¼Œå¹¶ä¸”èŽ·å–SSLè¯ä¹¦è¿‡æœŸæ—¶é—´ï¼Œæ¥éªŒè¯è¯ä¹¦æ˜¯å¦æ›´æ–°ã€‚ èŽ·å–åŸŸåä¸‹çš„è§£æžä¿¡æ¯ç™»å½•åŸŸåæœåŠ¡å•†æŽ§åˆ¶æ¡â€”äº‘è§£æžâ€”åŸŸåè§£æžåˆ—è¡¨â€”å¯¼å‡ºè§£æžè®°å½• å°†äºŒçº§åŸŸåçš„è®°å½•å†™å…¥domains.txtæ–‡ä»¶å¤‡ç”¨ ç¼–å†™è„šæœ¬1234567891011#!/bin/bashfor domain in `cat domains.txt` #è¯»å–å­˜å‚¨äº†éœ€è¦ç›‘æµ‹çš„åŸŸåçš„æ–‡ä»¶do curl $domain.vcg.com:443 1&gt;/dev/null 2&gt;/dev/null --connect-timeout 3 if [[ $? -eq 0 ]]; then END_TIME=$(echo | openssl s_client -servername $domain.vcg.com -connect $domain.vcg.com:443 2&gt;/dev/null | openssl x509 -noout -dates |grep 'After'| awk -F '=' '&#123;print $2&#125;'| awk -F ' +' '&#123;print $1,$2,$4 &#125;' ) echo "$domain.vcg.com çš„SSLè¯ä¹¦åˆ°æœŸæ—¶é—´ä¸º $END_TIME " &gt;&gt; result1.txt else echo "$domain.vcg.com æ²¡https " &gt;&gt; result1.txt fidone æ ¹æ®è¾“å‡ºæ–‡ä»¶æŸ¥çœ‹SSLè¯ä¹¦è¿‡æœŸæ—¶é—´ï¼Œè¿›è¡Œè¯ä¹¦æ›¿æ¢å·¥ä½œSSLè¯ä¹¦æ›´æ–°çš„é…ç½®è·¯å¾„ é˜¿é‡Œäº‘OSS-å¯¹è±¡å­˜å‚¨ é˜¿é‡Œäº‘WAF-Webé˜²ç«å¢™ é˜¿é‡Œäº‘SLB-è´Ÿè½½å‡è¡¡ Nginx #####]]></content>
      <categories>
        <category>Linux</category>
        <category>SSLè¯ä¹¦</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>SSLè¯ä¹¦</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æš´åŠ›ç ´è§£æ”»å‡»å’Œé˜²å¾¡]]></title>
    <url>%2F2019%2F04%2F16%2F%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E6%94%BB%E5%87%BB%E5%92%8C%E9%98%B2%E5%BE%A1%2F</url>
    <content type="text"><![CDATA[å¼•ç”¨è‡ªé˜¿é‡Œäº‘https://help.aliyun.com/knowledge_detail/56269.html ä»€ä¹ˆæ˜¯æš´åŠ›ç ´è§£æ”»å‡»æš´åŠ›ç ´è§£æ”»å‡»æ˜¯æŒ‡æ”»å‡»è€…é€šè¿‡ç³»ç»Ÿåœ°ç»„åˆå¹¶å°è¯•æ‰€æœ‰çš„å¯èƒ½æ€§ä»¥ç ´è§£ç”¨æˆ·çš„ç”¨æˆ·åã€å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯ã€‚æ”»å‡»è€…å¾€å¾€å€ŸåŠ©è‡ªåŠ¨åŒ–è„šæœ¬å·¥å…·æ¥å‘åŠ¨æš´åŠ›ç ´è§£æ”»å‡»ã€‚ æ”»å‡»è¡Œä¸ºç±»åž‹æ ¹æ®æš´åŠ›ç ´è§£çš„ç©·ä¸¾æ–¹å¼ï¼Œå…¶æ”»å‡»è¡Œä¸ºå¯ä»¥åˆ†ä¸ºï¼š å­—å…¸æ”»å‡»æ³•ã€‚å¤§å¤šæ”»å‡»è€…å¹¶æ²¡æœ‰é«˜æ€§èƒ½çš„ç ´è§£ç®—æ³•å’ŒCPU/GPUï¼Œä¸ºèŠ‚çœæ—¶é—´å’Œæé«˜æ•ˆçŽ‡ï¼Œä¼šåˆ©ç”¨ç¤¾ä¼šå·¥ç¨‹å­¦æˆ–å…¶å®ƒæ–¹å¼å»ºç«‹ç ´è¯‘å­—å…¸ï¼Œä½¿ç”¨å­—å…¸ä¸­å·²å­˜åœ¨çš„ç”¨æˆ·åã€å¯†ç è¿›è¡ŒçŒœç ´ã€‚ ç©·ä¸¾æ³•ã€‚æ”»å‡»è€…é¦–å…ˆåˆ—å‡ºå¯†ç ç»„åˆçš„å¯èƒ½æ€§ï¼ˆå¦‚æ•°å­—ã€å¤§å†™å­—æ¯ã€å°å†™å­—æ¯ã€ç‰¹æ®Šå­—ç¬¦ç­‰ï¼‰ï¼Œç„¶åŽæŒ‰å¯†ç é•¿åº¦ä»Ž1ä½ã€2ä½â€¦.æž„æˆä¸åŒçš„è´¦å·å’Œå¯†ç å¯¹ï¼Œç„¶åŽé€ä¸ªçŒœè¯•ã€‚è¯¥æ–¹æ³•éœ€è¦é«˜æ€§èƒ½çš„ç ´è§£ç®—æ³•å’ŒCPU/GPUä½œæ”¯æŒã€‚ ç»„åˆå¼æ”»å‡»æ³•ã€‚ä½¿ç”¨å­—å…¸æ”»å‡»å’Œç©·ä¸¾æ³•çš„ç»„åˆæ”»å‡»æ–¹å¼ã€‚ ç†è®ºä¸Šï¼Œåªè¦æ‹¥æœ‰æ€§èƒ½è¶³å¤Ÿå¼ºçš„è®¡ç®—æœºå’Œè¶³å¤Ÿé•¿çš„æ—¶é—´ï¼Œå¤§å¤šå¯†ç å‡å¯ä»¥è¢«ç ´è§£å‡ºæ¥ã€‚ æ”»å‡»ä¸šåŠ¡ç±»åž‹ é’ˆå¯¹Windowsæ“ä½œç³»ç»Ÿçš„è¿œç¨‹æ¡Œé¢ç®¡ç†åè®®ï¼ˆRDPï¼‰ã€Linuxæ“ä½œç³»ç»Ÿçš„ç®¡ç†åè®®ï¼ˆSSHï¼‰çš„æš´åŠ›ç ´è§£æ”»å‡» é’ˆå¯¹å…·æœ‰ç™»å½•è®¤è¯æœºåˆ¶çš„è½¯ä»¶æœåŠ¡ï¼ˆå¦‚Mysqlã€SQLserverã€FTPã€Webå‰åŽç«¯ç™»å½•æŽ¥å£ç­‰åº”ç”¨æœåŠ¡ï¼‰çš„æš´åŠ›ç ´è§£æ”»å‡» å¯¹äºŽé˜²å¾¡è€…è€Œè¨€ï¼Œç»™æ”»å‡»è€…ç•™å¾—æ—¶é—´è¶Šé•¿ï¼Œå…¶ç»„åˆå‡ºæ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç çš„å¯èƒ½æ€§å°±è¶Šå¤§ã€‚å› æ­¤ï¼Œæ—¶é—´åœ¨æ£€æµ‹æš´åŠ›ç ´è§£æ”»å‡»æ—¶å¾ˆé‡è¦ã€‚ æš´åŠ›ç ´è§£æ”»å‡»æœ‰ä»€ä¹ˆå±å®³é€šè¿‡è‡ªåŠ¨åŒ–å·¥å…·å‘èµ·çš„æš´åŠ›ç ´è§£æ”»å‡»å¯ä»¥èŽ·å–ç”¨æˆ·è´¦å·å’Œå¯†ç ã€‚ å¦‚ä½•é˜²å¾¡æš´åŠ›ç ´è§£æ”»å‡» åˆ¶å®šå¯†ç å¤æ‚åº¦ç­–ç•¥ï¼Œå¹¶è¿›è¡ŒæœåŠ¡åŠ å›ºã€‚å¯†ç çš„é•¿åº¦è¦å¤§äºŽ 8 ä½ï¼Œä¸”æœ€å¥½å¤§äºŽ 20 ä½ï¼›å¯†ç åº”ç”±æ•°å­—ã€å¤§å°å†™å­—æ¯å’Œç‰¹æ®Šç¬¦å·æ··åˆç»„æˆï¼›å¯†ç çš„æœ€é•¿æœ‰æ•ˆæœŸä¸º 90 å¤©ã€‚ é…ç½®å¥½ç½‘ç»œè®¿é—®æŽ§åˆ¶ã€‚ä¸¥æ ¼é™åˆ¶å°†é«˜å±æœåŠ¡ç®¡ç†ç«¯å£ç›´æŽ¥å‘å¸ƒåˆ°äº’è”ç½‘ï¼›å»ºè®®æ‚¨ä½¿ç”¨ VPN å’Œå ¡åž’æœºçš„æ–¹å¼é›†ä¸­ç®¡ç†å’Œå®¡è®¡ã€‚ æé«˜å†…éƒ¨å…¨å‘˜å®‰å…¨æ„è¯†ï¼Œç¦æ­¢å€Ÿç”¨æˆ–å…±äº«ä½¿ç”¨è´¦å·ã€‚]]></content>
      <categories>
        <category>Linux</category>
        <category>å®‰å…¨</category>
      </categories>
      <tags>
        <tag>å®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ElasticsearchæœåŠ¡å®‰å…¨åŠ å›º]]></title>
    <url>%2F2019%2F04%2F16%2FElasticsearch%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%2F</url>
    <content type="text"><![CDATA[å¼•ç”¨è‡ªé˜¿é‡Œäº‘https://help.aliyun.com/knowledge_detail/49913.html&gt; Elasticsearch æ˜¯ä¸€ä¸ªåŸºäºŽ Lucene çš„æœç´¢æœåŠ¡ï¼Œå®ƒæä¾›äº† RESTful web æŽ¥å£çš„åˆ†å¸ƒå¼ã€å¤šç”¨æˆ·å…¨æ–‡æœç´¢å¼•æ“Ž ã€‚Elasticsearch æ˜¯ç”¨ Java å¼€å‘çš„ï¼Œå¹¶ä½œä¸º Apache è®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯ç¬¬äºŒå¤§æœ€æµè¡Œçš„ä¼ä¸šæœç´¢å¼•æ“Žã€‚ Elasticsearch åº”ç”¨äºŽäº‘è®¡ç®—ä¸­ï¼Œå…·æœ‰å®žæ—¶æœç´¢ã€ç¨³å®šã€å¯é ã€å¿«é€Ÿã€å®‰è£…ä½¿ç”¨æ–¹ä¾¿ç­‰ä¼˜åŠ¿ï¼›ä½†ä¹Ÿå­˜åœ¨ä¸€äº›å®‰å…¨éšæ‚£ï¼šé»˜è®¤å®‰è£…å®ŒæˆåŽï¼ŒElasticsearch å¯ä»¥ä½¿ç”¨ 9200 ç«¯å£é€šå‘Š web çš„æ–¹å¼è®¿é—®æŸ¥çœ‹æ•°æ®ä¿¡æ¯ã€‚ æ¼æ´žè¯¦æƒ…Elasticsearch ä¸­å­˜åœ¨ä»¥ä¸‹é«˜å±æ¼æ´žã€‚ ç±»åž‹ CVE å—å½±å“ç‰ˆæœ¬ æè¿° è¿œç¨‹å‘½ä»¤æ‰§è¡Œ CVE-2014-3120 - Elasticsearch çš„è„šæœ¬æ‰§è¡Œ (scripting) åŠŸèƒ½ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®è¿›è¡Œå†åŠ å·¥å¤„ç†ã€‚ä½†æ˜¯ï¼Œå…¶ä½¿ç”¨çš„ MVEL è„šæœ¬å¼•æ“Žæ²¡æœ‰åšè¿‡ä»»ä½•é˜²æŠ¤ï¼ˆæˆ–è€…æ²™ç›’åŒ…è£…ï¼‰ï¼Œå¯ä»¥ç›´æŽ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚ è¿œç¨‹ä»£ç æ‰§è¡Œ - 1.3.0-1.3.7ï¼Œ1.4.0-1.4 Elasticsearch ä½¿ç”¨ Groovy ä½œä¸ºè„šæœ¬è¯­è¨€ï¼Œè™½ç„¶åŠ å…¥äº†æ²™ç›’è¿›è¡ŒæŽ§åˆ¶ï¼Œå±é™©çš„ä»£ç ä¼šè¢«æ‹¦æˆªã€‚ä½†æ˜¯ç”±äºŽæ²™ç›’é™åˆ¶ä¸ä¸¥æ ¼ï¼Œä»…é€šè¿‡é»‘ç™½åå•æ¥åˆ¤æ–­ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥ç»•è¿‡æ²™ç›’ï¼Œæ‰§è¡Œè¿œç¨‹ä»£ç ã€‚ æœªæŽˆæƒè®¿é—® - - Elasticsearch åœ¨å®‰è£…äº† River æœºåˆ¶ä¹‹åŽå¯ä»¥åŒæ­¥å¤šç§æ•°æ®åº“æ•°æ®ï¼ˆåŒ…æ‹¬å…³ç³»åž‹çš„MySQLã€MongoDB ç­‰ï¼‰ã€‚å¦‚æžœ http://localhost:9200/cat/indicesä¸­ indices åŒ…å«äº† _riverï¼Œåˆ™ä»£è¡¨ Elasticsearch å·²å®‰è£… River æœºåˆ¶ã€‚è€Œé€šè¿‡æ³„éœ²çš„ http://localhost:9200/_rvier/_search URL åœ°å€ï¼Œæ”»å‡»è€…å¯ä»¥èŽ·å–åˆ°æ•æ„Ÿä¿¡æ¯ã€‚ æ¼æ´žæˆå› ä¸Žå±å®³ç”±äºŽ Elasticsearch çš„ HTTP è¿žæŽ¥æ²¡æœ‰æä¾›ä»»ä½•çš„æƒé™æŽ§åˆ¶æŽªæ–½ï¼Œä¸€æ—¦éƒ¨ç½²åœ¨å…¬å…±ç½‘ç»œå°±å®¹æ˜“æœ‰æ•°æ®æ³„éœ²çš„é£Žé™©ã€‚ å®‰å…¨åŠ å›ºæ–¹æ¡ˆä½¿ç”¨æœ€æ–°çš„ Elasticsearch ç‰ˆæœ¬é€šè¿‡æ­£è§„æ¸ é“ï¼ˆå¦‚ Elastic å®˜ç½‘ï¼‰ä¸‹è½½ Elasticsearch çš„æœ€æ–°ç‰ˆæœ¬ã€‚ ä¸‹è½½å®ŒæˆåŽï¼Œå°†ä¸‹è½½æ–‡ä»¶çš„ sha1 å€¼å’Œä¸‹è½½æ—¶å®˜ç½‘é¡µé¢æä¾›çš„ sha1 å€¼è¿›è¡Œå¯¹æ¯”ï¼Œé¿å…ä¸‹è½½è¿‡ç¨‹ä¸­è¢«æ¶æ„æ”»å‡»è€…æ‹¦æˆªç ´åæ–‡ä»¶ï¼Œç”šè‡³æ³¨å…¥æ¶æ„ä»£ç ã€‚ ä¸è¦éšä¾¿å®‰è£…ç¬¬ä¸‰æ–¹çš„æ’ä»¶ï¼Œæ’ä»¶æœ‰å¯èƒ½å¼•å…¥å®‰å…¨æ¼æ´žç”šè‡³æœ¬èº«è‡ªå¸¦åŽé—¨ï¼Œéœ€è°¨æ…Žä½¿ç”¨ã€‚ å…³æ³¨ Elastic ç½‘ç«™ï¼ŒåŠæ—¶æ›´æ–° Elasticsearch è‡³æœ€æ–°ç‰ˆæœ¬ã€‚Elasticsearch æ¯æ¬¡ç‰ˆæœ¬å‘å¸ƒéƒ½ä¼šä¼˜åŒ–å’Œæ”¹è¿›ä¸€éƒ¨åˆ†åŠŸèƒ½ï¼Œå°¤å…¶æ˜¯å®‰å…¨æ¼æ´žçš„è¡¥ä¸ã€‚åŒæ—¶ï¼Œä»”ç»†é˜…è¯» Elasticsearch çš„ç‰ˆæœ¬æ›´æ–°è®°å½•ã€‚ æ³¨æ„ï¼šæ›´æ–°å‡çº§å‰ï¼Œå»ºè®®æ‚¨å…ˆè¿›è¡Œå¿«ç…§å¤‡ä»½ï¼ŒåŠæœ¬åœ°æµ‹è¯•ã€‚ ï¼ˆæŽ¨èï¼‰ç½‘ç»œè®¿é—®æŽ§åˆ¶Elasticsearch é»˜è®¤ç«¯å£æ˜¯ 9200ã€‚ ä¸è¦æŠŠ Elasticsearch çš„ 9200 ç«¯å£æœåŠ¡å‘å¸ƒåˆ°äº’è”ç½‘ä¸Šã€‚ ä½¿ç”¨ é˜¿é‡Œäº‘å®‰å…¨ç»„é˜²ç«å¢™ æˆ–æœ¬åœ°æ“ä½œç³»ç»Ÿé˜²ç«å¢™å¯¹è®¿é—®æº IP è¿›è¡Œéš”ç¦»æŽ§åˆ¶ã€‚ ç»‘å®šè®¿é—®æº IPè¿›å…¥ config ç›®å½•ï¼Œä¿®æ”¹ elasticsearch.yml é…ç½®æ–‡ä»¶ä¸­ä»¥ä¸‹å‚æ•°ï¼š 123456network.bind_host: 192.168.0.1# è®¾ç½®ç»‘å®šçš„ IP åœ°å€ï¼Œå¯ä»¥æ˜¯ IPv4 æˆ– IPv6 åœ°å€ï¼Œé»˜è®¤ä¸º 0.0.0.0ã€‚network.publish_host: 192.168.0.1# è®¾ç½®å…¶å®ƒèŠ‚ç‚¹å’Œè¯¥èŠ‚ç‚¹äº¤äº’çš„ IP åœ°å€ï¼Œå¦‚æžœä¸è®¾ç½®å®ƒä¼šè‡ªåŠ¨åˆ¤æ–­ï¼Œå€¼å¿…é¡»æ˜¯ä¸ªçœŸå®žçš„ IP åœ°å€ã€‚network.host: 192.168.0.1# åŒæ—¶è®¾ç½®ä¸Šè¿°ä¸¤ä¸ªå‚æ•°ï¼šbind_host å’Œ publish_hostã€‚ ä¿®æ”¹é»˜è®¤ç«¯å£è¿›å…¥ config ç›®å½•ï¼Œä¿®æ”¹ elasticsearch.yml é…ç½®æ–‡ä»¶ä¸­ä»¥ä¸‹å‚æ•°ï¼š 123456ransport.tcp.port: 9300# è®¾ç½®èŠ‚ç‚¹é—´äº¤äº’çš„ TCP ç«¯å£ï¼Œé»˜è®¤æ˜¯ 9300ã€‚transport.tcp.compress: true# è®¾ç½®æ˜¯å¦åŽ‹ç¼© TCP ä¼ è¾“æ—¶çš„æ•°æ®ï¼Œé»˜è®¤ä¸º falseï¼Œå³ä¸åŽ‹ç¼©ã€‚http.port: 9200# è®¾ç½®å¯¹å¤–æœåŠ¡çš„ HTTP ç«¯å£ï¼Œé»˜è®¤ä¸º 9200ã€‚ å…³é—­ HTTP è®¿é—®è¿›å…¥ config ç›®å½•ï¼Œä¿®æ”¹ elasticsearch.yml é…ç½®æ–‡ä»¶ä¸­ä»¥ä¸‹å‚æ•°ï¼š 12http.enabled: false# æ˜¯å¦ä½¿ç”¨ HTTP åè®®å¯¹å¤–æä¾›æœåŠ¡ï¼Œé»˜è®¤ä¸º trueï¼Œå³å¼€å¯ã€‚ ä½¿ç”¨ Shield å®‰å…¨æ’ä»¶Shield æ˜¯ Elastic å…¬å¸ä¸º Elasticsearch å¼€å‘çš„ä¸€ä¸ªå®‰å…¨æ’ä»¶ã€‚åœ¨å®‰è£…æ­¤æ’ä»¶åŽï¼ŒShield ä¼šæ‹¦æˆªæ‰€æœ‰å¯¹ Elasticsearch çš„è¯·æ±‚ï¼Œå¹¶è¿›è¡Œè®¤è¯ä¸ŽåŠ å¯†ï¼Œä¿éšœ Elasticsearch åŠç›¸å…³ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚Shield æ˜¯å•†ä¸šæ’ä»¶ï¼Œéœ€è¦ Elasticsearch çš„å•†ä¸šè®¸å¯ã€‚ç¬¬ä¸€æ¬¡å®‰è£…è®¸å¯çš„æ—¶å€™ï¼Œä¼šæä¾› 30 å¤©çš„å…è´¹è¯•ç”¨æƒé™ã€‚30 å¤©åŽï¼ŒShield å°†ä¼šå±è”½ clusterhealth, cluster stats, index stats ç­‰ APIï¼Œå…¶ä½™åŠŸèƒ½ä¸å—å½±å“ã€‚ ç”¨æˆ·è®¤è¯ä½¿ç”¨ Shield å¯ä»¥å®šä¹‰ä¸€ç³»åˆ—å·²çŸ¥çš„ç”¨æˆ·ï¼Œå¹¶ç”¨å…¶è®¤è¯ç”¨æˆ·è¯·æ±‚ã€‚è¿™äº›ç”¨æˆ·å­˜åœ¨äºŽæŠ½è±¡çš„â€œåŸŸâ€ä¸­ã€‚ä¸€ä¸ªâ€œåŸŸâ€å¯ä»¥æ˜¯ä¸‹é¢å‡ ç§ç±»åž‹ï¼š LDAP æœåŠ¡ ActiveDirectory æœåŠ¡ æœ¬åœ° esusers é…ç½®æ–‡ä»¶ï¼ˆç±»ä¼¼ /etc/passwd) æƒé™æŽ§åˆ¶Shield çš„æƒé™æŽ§åˆ¶åŒ…å«ä¸‹é¢å‡ ç§å…ƒç´ ï¼š è¢«ä¿æŠ¤çš„èµ„æº SecuredResourceï¼šæƒé™æ‰€åº”ç”¨åˆ°çš„å¯¹è±¡ï¼Œæ¯”å¦‚æŸä¸ª indexï¼Œcluster ç­‰ã€‚ ç‰¹æƒ Priviliegeï¼šè§’è‰²å¯¹å¯¹è±¡å¯ä»¥æ‰§è¡Œçš„ä¸€ç§æˆ–å¤šç§æ“ä½œï¼Œæ¯”å¦‚ readï¼Œwrite ç­‰ã€‚è¿˜å¯ä»¥æ˜¯ indicies:/data/read/perlocate ç­‰å¯¹æŸç§å¯¹è±¡ç‰¹æœ‰çš„æ“ä½œã€‚ è®¸å¯ Permissionsï¼šå¯¹è¢«ä¿æŠ¤çš„èµ„æºæ‹¥æœ‰çš„ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹æƒï¼Œå¦‚ read on the&quot;products&quot; indexã€‚ è§’è‰² Roleï¼šä¸€ç»„è®¸å¯çš„é›†æˆï¼Œå…·æœ‰ç‹¬ç«‹çš„åç§°ã€‚ ç”¨æˆ· Usersï¼šç”¨æˆ·å®žä½“ï¼Œå¯ä»¥è¢«èµ‹äºˆå¤šç§è§’è‰²ï¼Œä»–ä»¬å¯ä»¥å¯¹è¢«ä¿æŠ¤çš„èµ„æºæ‰§è¡Œç›¸åº”è§’è‰²æ‰€æ‹¥æœ‰çš„å„ç§ç‰¹æƒã€‚ å®‰è£… Shieldæ‰§è¡Œå®‰è£…æ­¥éª¤å‰ï¼Œè¯·ç¡®ä¿æ»¡è¶³ä»¥ä¸‹å®‰è£…çŽ¯å¢ƒæ¡ä»¶ï¼š æ‚¨å®‰è£…äº† Java7 æˆ–æ›´æ–°ç‰ˆæœ¬ã€‚ æ‚¨å°† Elasticsearch 1.5.0+ è§£åŽ‹å®‰è£…åˆ°äº†æœ¬æœºä¸Šã€‚å¦‚æžœæ‚¨ä½¿ç”¨ APT æˆ– YUM å®‰è£…ï¼Œé»˜è®¤çš„å®‰è£…ç›®å½•å¯èƒ½åœ¨ /usr/share/elasticsearchã€‚ å‚ç…§ä»¥ä¸‹æ­¥éª¤å®Œæˆå®‰è£…ï¼š è¿›å…¥ Elasticsearch å®‰è£…ç›®å½•ï¼š 1cd /usr/share/elasticsearch å®‰è£… Elasticsearch è®¸å¯æ’ä»¶ï¼š 1bin/plugin -i elasticsearch/license/latest å®‰è£… Shield æ’ä»¶ï¼š 1bin/plugin -i elasticsearch/shield/latest å°† Shield é…ç½®æ–‡ä»¶ç§»åŠ¨æˆ–é“¾æŽ¥è‡³ /etc/elasticsearch/shield ç›®å½•ä¸­ï¼š 1ln -s /usr/share/elasticsearch/config/shield /etc/elasticsearch/shield è¯´æ˜Žï¼šElasticsearch æœåŠ¡åœ¨å¯åŠ¨æ—¶ä¼šåœ¨ /etc/elasticsearch/shield ç›®å½•ä¸‹å¯»æ‰¾ Shield é…ç½®æ–‡ä»¶ï¼Œè€Œè¿™äº›é…ç½®æ–‡ä»¶åœ¨å®‰è£… Shield æ—¶ä¼šå‡ºçŽ°åœ¨ /usr/share/elasticsearch/config/shield ä¸­ï¼Œå› æ­¤éœ€è¦å°†é…ç½®æ–‡ä»¶ç§»åŠ¨æˆ–é“¾æŽ¥è‡³è¯¥ç›®å½•ã€‚ é‡å¯ Elasticsearch æœåŠ¡ï¼š 1service elasticsearch restart æ–°å»ºä¸€ä¸ª Elasticsearch ç®¡ç†å‘˜è´¦æˆ·ï¼Œå¡«å†™æ–°å¯†ç ï¼š 1bin/shield/esusersuseradd es_admin -r admin ç›´æŽ¥ä½¿ç”¨ RESTFUL API è®¿é—® Elasticsearch çš„è¯·æ±‚éƒ½ä¼šè¢«æ‹’ç»ï¼š 1curl -XGET&apos;http://localhost:9200/&apos; éœ€è¦åœ¨è¯·æ±‚ä¸­æ·»åŠ ç”¨æˆ·åå’Œå¯†ç ï¼š 1curl -u es_admin -XGET &apos;http://localhost:9200/&apos; æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒï¼š Shield å®˜æ–¹å®‰è£…æŒ‡å— Shield å®˜æ–¹ä½¿ç”¨é…ç½®æŒ‡å— ä¿®æ”¹é»˜è®¤çš„ Elasticsearch é›†ç¾¤åç§°Elasticsearch é»˜è®¤çš„é›†ç¾¤åç§°æ˜¯ elasticsearchï¼Œè¯·åœ¨æ‚¨çš„ç”Ÿäº§çŽ¯å¢ƒä¸­å°†å…¶ä¿®æ”¹æˆå…¶ä»–åç§°ã€‚ç¡®ä¿åœ¨ä¸åŒçš„çŽ¯å¢ƒå’Œä¸åŒçš„é›†ç¾¤ä¸‹ä½¿ç”¨ä¸åŒçš„åç§°ï¼›å¹¶ä¸”åœ¨ç›‘æŽ§é›†ç¾¤èŠ‚ç‚¹æ—¶ï¼Œå¦‚æžœæœ‰æœªçŸ¥èŠ‚ç‚¹åŠ å…¥ï¼Œä¸€å®šè¦åŠæ—¶é¢„è­¦ã€‚ ä¸è¦ä»¥ root èº«ä»½è¿è¡Œ Elasticsearchä¸è¦ä»¥ root èº«ä»½æ¥è¿è¡Œ Elasticsearchï¼Œä¸è¦å’Œå…¶ä»–æœåŠ¡å…±ç”¨ç›¸åŒçš„ç”¨æˆ·ï¼Œå¹¶æŠŠç”¨æˆ·çš„æƒé™æœ€å°åŒ–ã€‚ åº”ç”¨ç¤ºä¾‹ï¼š 1sudo -u es-user ES_JAVA_OPTS=&quot;-Xms1024m -Xmx1024m&quot;/opt/elasticsearch/bin/elasticsearc æ­£ç¡®è®¾ç½® Elasticsearch çš„æ•°æ®ç›®å½•è¯·ç¡®ä¿ä¸º Elasticsearch çš„ç›®å½•åˆ†é…äº†åˆç†çš„è¯»å†™æƒé™ï¼Œé¿å…ä½¿ç”¨å…±äº«æ–‡ä»¶ç³»ç»Ÿã€‚ç¡®ä¿åªæœ‰ Elasticsearch çš„å¯åŠ¨ç”¨æˆ·æ‰æœ‰æƒè®¿é—®ç›®å½•ã€‚æ—¥å¿—ç›®å½•ä¹Ÿéœ€è¦æ­£ç¡®é…ç½®ï¼Œé¿å…æ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚ å®šæœŸå¯¹ Elasticsearch è¿›è¡Œå¤‡ä»½ä½¿ç”¨ Elasticsearch æä¾›çš„å¤‡ä»½è¿˜åŽŸæœºåˆ¶ï¼Œå®šæœŸå¯¹ Elasticsearch çš„æ•°æ®è¿›è¡Œå¿«ç…§å¤‡ä»½ã€‚ ç¦ç”¨æ‰¹é‡åˆ é™¤ç´¢å¼•Elasticsearch æ”¯æŒä½¿ç”¨å…¨éƒ¨ï¼ˆ_allï¼‰å’Œé€šé…ç¬¦ï¼ˆ*ï¼‰æ¥æ‰¹é‡åˆ é™¤ç´¢å¼•ã€‚åœ¨ç”Ÿäº§çŽ¯å¢ƒï¼Œè¯¥æ“ä½œå­˜åœ¨ä¸€å®šé£Žé™©ï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½® action.destructive_requires_name: true å‚æ•°æ¥ç¦ç”¨å®ƒã€‚ å¯ç”¨æ—¥å¿—è®°å½•åŠŸèƒ½Elasticsearch çš„ config æ–‡ä»¶å¤¹é‡Œé¢æœ‰ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼š elasticsearch.ymlï¼šåŸºæœ¬é…ç½®æ–‡ä»¶ã€‚ logging.ymlï¼šæ—¥å¿—é…ç½®æ–‡ä»¶ã€‚ç”±äºŽ Elasticsearch ä½¿ç”¨ log4j æ¥è®°å½•æ—¥å¿—çš„ï¼Œlogging.yml ä¸­çš„è®¾ç½®è¯·æŒ‰æ™®é€š log4j é…ç½®æ–‡ä»¶è¿›è¡Œè®¾ç½®ã€‚ å¯ç”¨æ—¥å¿—åŠŸèƒ½éœ€è¦ä¿®æ”¹ elasticsearch.yml é…ç½®æ–‡ä»¶ï¼š 1path.logs: /path/to/logs# è®¾ç½®æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤æ˜¯ Elasticsearch æ ¹ç›®å½•ä¸‹çš„ logs æ–‡ä»¶å¤¹]]></content>
      <categories>
        <category>Elasticsearch</category>
      </categories>
      <tags>
        <tag>Elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxæ“ä½œç³»ç»ŸåŠ å›º]]></title>
    <url>%2F2019%2F04%2F16%2FLinux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8A%A0%E5%9B%BA%2F</url>
    <content type="text"><![CDATA[å¼•è‡ªé˜¿é‡Œäº‘https://help.aliyun.com/knowledge_detail/49809.html&gt; æœ¬å¸®åŠ©æ‰‹å†Œæ—¨åœ¨æŒ‡å¯¼ç³»ç»Ÿç®¡ç†äººå‘˜æˆ–å®‰å…¨æ£€æŸ¥äººå‘˜è¿›è¡ŒLinuxæ“ä½œç³»ç»Ÿçš„å®‰å…¨åˆè§„æ€§æ£€æŸ¥å’ŒåŠ å›ºã€‚ 1. è´¦å·å’Œå£ä»¤1.1 ç¦ç”¨æˆ–åˆ é™¤æ— ç”¨è´¦å·å‡å°‘ç³»ç»Ÿæ— ç”¨è´¦å·ï¼Œé™ä½Žå®‰å…¨é£Žé™©ã€‚ æ“ä½œæ­¥éª¤ ä½¿ç”¨å‘½ä»¤ userdel &lt;ç”¨æˆ·å&gt; åˆ é™¤ä¸å¿…è¦çš„è´¦å·ã€‚ ä½¿ç”¨å‘½ä»¤ passwd -l &lt;ç”¨æˆ·å&gt; é”å®šä¸å¿…è¦çš„è´¦å·ã€‚ ä½¿ç”¨å‘½ä»¤ passwd -u &lt;ç”¨æˆ·å&gt; è§£é”å¿…è¦çš„è´¦å·ã€‚ 1.2 æ£€æŸ¥ç‰¹æ®Šè´¦å·æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç©ºå£ä»¤å’Œrootæƒé™çš„è´¦å·ã€‚ æ“ä½œæ­¥éª¤ æŸ¥çœ‹ç©ºå£ä»¤å’Œrootæƒé™è´¦å·ï¼Œç¡®è®¤æ˜¯å¦å­˜åœ¨å¼‚å¸¸è´¦å·ï¼š ä½¿ç”¨å‘½ä»¤ awk -F: &#39;($2==&quot;&quot;)&#39; /etc/shadow æŸ¥çœ‹ç©ºå£ä»¤è´¦å·ã€‚ ä½¿ç”¨å‘½ä»¤ awk -F: &#39;($3==0)&#39; /etc/passwd æŸ¥çœ‹UIDä¸ºé›¶çš„è´¦å·ã€‚ åŠ å›ºç©ºå£ä»¤è´¦å·ï¼š ä½¿ç”¨å‘½ä»¤ passwd &lt;ç”¨æˆ·å&gt; ä¸ºç©ºå£ä»¤è´¦å·è®¾å®šå¯†ç ã€‚ ç¡®è®¤UIDä¸ºé›¶çš„è´¦å·åªæœ‰rootè´¦å·ã€‚ 1.3 æ·»åŠ å£ä»¤ç­–ç•¥åŠ å¼ºå£ä»¤çš„å¤æ‚åº¦ç­‰ï¼Œé™ä½Žè¢«çŒœè§£çš„å¯èƒ½æ€§ã€‚ æ“ä½œæ­¥éª¤ ä½¿ç”¨å‘½ä»¤ 1vi /etc/login.defs ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚ PASS_MAX_DAYS 90 #æ–°å»ºç”¨æˆ·çš„å¯†ç æœ€é•¿ä½¿ç”¨å¤©æ•° PASS_MIN_DAYS 0 #æ–°å»ºç”¨æˆ·çš„å¯†ç æœ€çŸ­ä½¿ç”¨å¤©æ•° PASS_WARN_AGE 7 #æ–°å»ºç”¨æˆ·çš„å¯†ç åˆ°æœŸæå‰æé†’å¤©æ•° ä½¿ç”¨chageå‘½ä»¤ä¿®æ”¹ç”¨æˆ·è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œchage -m 0 -M 30 -E 2000-01-01 -W 7 &lt;ç”¨æˆ·å&gt;è¡¨ç¤ºå°†æ­¤ç”¨æˆ·çš„å¯†ç æœ€é•¿ä½¿ç”¨å¤©æ•°è®¾ä¸º30ï¼Œæœ€çŸ­ä½¿ç”¨å¤©æ•°è®¾ä¸º0ï¼Œå¯†ç 2000å¹´1æœˆ1æ—¥è¿‡æœŸï¼Œè¿‡æœŸå‰ä¸ƒå¤©è­¦å‘Šç”¨æˆ·ã€‚ è®¾ç½®è¿žç»­è¾“é”™ä¸‰æ¬¡å¯†ç ï¼Œè´¦å·é”å®šäº”åˆ†é’Ÿã€‚ä½¿ç”¨å‘½ä»¤ vi /etc/pam.d/common-authä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  auth required pam_tally.so onerr=fail deny=3 unlock_time=300ã€‚ 1.4 é™åˆ¶ç”¨æˆ·sué™åˆ¶èƒ½suåˆ°rootçš„ç”¨æˆ·ã€‚ æ“ä½œæ­¥éª¤ ä½¿ç”¨å‘½ä»¤ vi /etc/pam.d/suä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ è¡Œã€‚ä¾‹å¦‚ï¼Œåªå…è®¸testç»„ç”¨æˆ·suåˆ°rootï¼Œåˆ™æ·»åŠ  auth required pam_wheel.so group=testã€‚ 1.4 ç¦æ­¢rootç”¨æˆ·ç›´æŽ¥ç™»å½•é™åˆ¶rootç”¨æˆ·ç›´æŽ¥ç™»å½•ã€‚ æ“ä½œæ­¥éª¤ åˆ›å»ºæ™®é€šæƒé™è´¦å·å¹¶é…ç½®å¯†ç ,é˜²æ­¢æ— æ³•è¿œç¨‹ç™»å½•; ä½¿ç”¨å‘½ä»¤ vi /etc/ssh/sshd_configä¿®æ”¹é…ç½®æ–‡ä»¶å°†PermitRootLoginçš„å€¼æ”¹æˆnoï¼Œå¹¶ä¿å­˜ï¼Œç„¶åŽä½¿ç”¨service sshd restarté‡å¯æœåŠ¡ã€‚ 2. æœåŠ¡2.1 å…³é—­ä¸å¿…è¦çš„æœåŠ¡å…³é—­ä¸å¿…è¦çš„æœåŠ¡ï¼ˆå¦‚æ™®é€šæœåŠ¡å’ŒxinetdæœåŠ¡ï¼‰ï¼Œé™ä½Žé£Žé™©ã€‚ æ“ä½œæ­¥éª¤ ä½¿ç”¨å‘½ä»¤systemctl disable &lt;æœåŠ¡å&gt;è®¾ç½®æœåŠ¡åœ¨å¼€æœºæ—¶ä¸è‡ªåŠ¨å¯åŠ¨ã€‚ è¯´æ˜Žï¼š å¯¹äºŽéƒ¨åˆ†è€ç‰ˆæœ¬çš„Linuxæ“ä½œç³»ç»Ÿï¼ˆå¦‚CentOS 6ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤chkconfig --level &lt;initçº§åˆ«&gt; &lt;æœåŠ¡å&gt; offè®¾ç½®æœåŠ¡åœ¨æŒ‡å®šinitçº§åˆ«ä¸‹å¼€æœºæ—¶ä¸è‡ªåŠ¨å¯åŠ¨ã€‚ 2.2 SSHæœåŠ¡å®‰å…¨å¯¹SSHæœåŠ¡è¿›è¡Œå®‰å…¨åŠ å›ºï¼Œé˜²æ­¢æš´åŠ›ç ´è§£æˆåŠŸã€‚ æ“ä½œæ­¥éª¤ ä½¿ç”¨å‘½ä»¤ vim /etc/ssh/sshd_config ç¼–è¾‘é…ç½®æ–‡ä»¶ã€‚ ä¸å…è®¸rootè´¦å·ç›´æŽ¥ç™»å½•ç³»ç»Ÿã€‚è®¾ç½® PermitRootLogin çš„å€¼ä¸º noã€‚ ä¿®æ”¹SSHä½¿ç”¨çš„åè®®ç‰ˆæœ¬ã€‚è®¾ç½® Protocol çš„ç‰ˆæœ¬ä¸º 2ã€‚ ä¿®æ”¹å…è®¸å¯†ç é”™è¯¯æ¬¡æ•°ï¼ˆé»˜è®¤6æ¬¡ï¼‰ã€‚è®¾ç½® MaxAuthTries çš„å€¼ä¸º 3ã€‚ é…ç½®æ–‡ä»¶ä¿®æ”¹å®ŒæˆåŽï¼Œé‡å¯sshdæœåŠ¡ç”Ÿæ•ˆã€‚ 3. æ–‡ä»¶ç³»ç»Ÿ3.1 è®¾ç½®umaskå€¼è®¾ç½®é»˜è®¤çš„umaskå€¼ï¼Œå¢žå¼ºå®‰å…¨æ€§ã€‚ æ“ä½œæ­¥éª¤ ä½¿ç”¨å‘½ä»¤ vi /etc/profile ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ è¡Œ umask 027ï¼Œ å³æ–°åˆ›å»ºçš„æ–‡ä»¶å±žä¸»æ‹¥æœ‰è¯»å†™æ‰§è¡Œæƒé™ï¼ŒåŒç»„ç”¨æˆ·æ‹¥æœ‰è¯»å’Œæ‰§è¡Œæƒé™ï¼Œå…¶ä»–ç”¨æˆ·æ— æƒé™ã€‚ 3.2 è®¾ç½®ç™»å½•è¶…æ—¶è®¾ç½®ç³»ç»Ÿç™»å½•åŽï¼Œè¿žæŽ¥è¶…æ—¶æ—¶é—´ï¼Œå¢žå¼ºå®‰å…¨æ€§ã€‚ æ“ä½œæ­¥éª¤ ä½¿ç”¨å‘½ä»¤ vi /etc/profile ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå°†ä»¥ TMOUT= å¼€å¤´çš„è¡Œæ³¨é‡Šï¼Œè®¾ç½®ä¸ºTMOUT=180ï¼Œå³è¶…æ—¶æ—¶é—´ä¸ºä¸‰åˆ†é’Ÿã€‚ 4. æ—¥å¿—4.1 syslogdæ—¥å¿—å¯ç”¨æ—¥å¿—åŠŸèƒ½ï¼Œå¹¶é…ç½®æ—¥å¿—è®°å½•ã€‚ æ“ä½œæ­¥éª¤ Linuxç³»ç»Ÿé»˜è®¤å¯ç”¨ä»¥ä¸‹ç±»åž‹æ—¥å¿—ï¼š ç³»ç»Ÿæ—¥å¿—ï¼ˆé»˜è®¤ï¼‰/var/log/messages cronæ—¥å¿—ï¼ˆé»˜è®¤ï¼‰/var/log/cron å®‰å…¨æ—¥å¿—ï¼ˆé»˜è®¤ï¼‰/var/log/secure æ³¨æ„ï¼šéƒ¨åˆ†ç³»ç»Ÿå¯èƒ½ä½¿ç”¨syslog-ngæ—¥å¿—ï¼Œé…ç½®æ–‡ä»¶ä¸ºï¼š/etc/syslog-ng/syslog-ng.confã€‚ æ‚¨å¯ä»¥æ ¹æ®éœ€æ±‚é…ç½®è¯¦ç»†æ—¥å¿—ã€‚ 4.2 è®°å½•æ‰€æœ‰ç”¨æˆ·çš„ç™»å½•å’Œæ“ä½œæ—¥å¿—é€šè¿‡è„šæœ¬ä»£ç å®žçŽ°è®°å½•æ‰€æœ‰ç”¨æˆ·çš„ç™»å½•æ“ä½œæ—¥å¿—ï¼Œé˜²æ­¢å‡ºçŽ°å®‰å…¨äº‹ä»¶åŽæ— æ®å¯æŸ¥ã€‚ æ“ä½œæ­¥éª¤ è¿è¡Œ [root@xxx /]# vim /etc/profileæ‰“å¼€é…ç½®æ–‡ä»¶ã€‚ åœ¨é…ç½®æ–‡ä»¶ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š 123456789101112131415161718historyUSER=`whoami`USER_IP=`who -u am i 2&gt;/dev/null| awk '&#123;print $NF&#125;'|sed -e 's/[()]//g'`if [ "$USER_IP" = "" ]; thenUSER_IP=`hostname`fiif [ ! -d /var/log/history ]; thenmkdir /var/log/historychmod 777 /var/log/historyfiif [ ! -d /var/log/history/$&#123;LOGNAME&#125; ]; thenmkdir /var/log/history/$&#123;LOGNAME&#125;chmod 300 /var/log/history/$&#123;LOGNAME&#125;fiexport HISTSIZE=4096DT=`date +"%Y%m%d_%H:%M:%S"`export HISTFILE="/var/log/history/$&#123;LOGNAME&#125;/$&#123;USER&#125;@$&#123;USER_IP&#125;_$DT"chmod 600 /var/log/history/$&#123;LOGNAME&#125;/*history* 2&gt;/dev/null è¿è¡Œ [root@xxx /]# source /etc/profile åŠ è½½é…ç½®ç”Ÿæ•ˆã€‚æ³¨æ„ï¼š /var/log/history æ˜¯è®°å½•æ—¥å¿—çš„å­˜æ”¾ä½ç½®ï¼Œå¯ä»¥è‡ªå®šä¹‰ã€‚ é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œå¯ä»¥åœ¨ /var/log/history ç›®å½•ä¸‹ä»¥æ¯ä¸ªç”¨æˆ·ä¸ºåæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ¯æ¬¡ç”¨æˆ·é€€å‡ºåŽéƒ½ä¼šäº§ç”Ÿä»¥ç”¨æˆ·åã€ç™»å½•IPã€æ—¶é—´çš„æ—¥å¿—æ–‡ä»¶ï¼ŒåŒ…å«æ­¤ç”¨æˆ·æœ¬æ¬¡çš„æ‰€æœ‰æ“ä½œï¼ˆrootç”¨æˆ·é™¤å¤–ï¼‰ã€‚ åŒæ—¶ï¼Œå»ºè®®æ‚¨ä½¿ç”¨OSSæœåŠ¡æ”¶é›†å­˜å‚¨æ—¥å¿—ã€‚]]></content>
      <categories>
        <category>Linux</category>
        <category>å®‰å…¨</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ansible-å¿«é€Ÿæ·»åŠ å…å¯†ç è®¤è¯]]></title>
    <url>%2F2019%2F04%2F08%2FAnsible-%E5%BF%AB%E9%80%9F%E6%B7%BB%E5%8A%A0%E5%85%8D%E5%AF%86%E7%A0%81%E8%AE%A4%E8%AF%81%2F</url>
    <content type="text"><![CDATA[ç”Ÿæˆç®¡ç†æœºçš„ç§é’¥å’Œå…¬é’¥1ssh-keygen -t rsa -b 2048 -P '' -f /root/.ssh/id_rsa æ·»åŠ ä¸»æœºä¿¡æ¯åˆ°ä¸»æœºæ¸…å•ä¸­1vim /etc/ansible/hosts 123456789101112#æ·»åŠ åˆ†ç»„[test-k8s]172.20.21.249172.20.21.250172.20.21.251172.20.21.252172.20.21.253172.20.21.254172.20.21.255172.20.22.0172.20.22.1172.20.22.2 é…ç½®playbook1vim /etc/ansible/ssh-addkey.yml 12345678910---- hosts: pro-k8s gather_facts: no tasks: - name: install ssh key authorized_key: user=root key="&#123;&#123; lookup('file', '/root/.ssh/id_rsa.pub') &#125;&#125;" state=present è¿è¡Œplaybook1ansible-playbook -i /etc/ansible/hosts -k /etc/ansible/ssh-addkey.yml è¾“å…¥æœåŠ¡å™¨å¯†ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465SSH password:PLAY [pro-k8s] ***************************************************************************************************************************TASK [install ssh key] *******************************************************************************************************************changed: [172.21.5.197]changed: [172.21.5.196]changed: [172.21.5.199]changed: [172.21.5.192]changed: [172.21.5.195]changed: [172.21.5.193]changed: [172.21.2.240]changed: [172.21.5.198]changed: [172.21.2.238]changed: [172.21.5.194]changed: [172.21.2.236]changed: [172.21.2.235]changed: [172.21.2.237]changed: [172.21.2.239]changed: [172.21.2.234]changed: [172.21.0.159]changed: [172.21.0.155]changed: [172.21.2.241]changed: [172.21.0.154]changed: [172.21.0.153]changed: [172.21.0.158]changed: [172.21.0.152]changed: [172.21.0.160]changed: [172.21.0.156]changed: [172.21.0.157]changed: [172.21.2.232]changed: [172.21.2.233]changed: [172.21.0.151]changed: [172.21.5.191]PLAY RECAP *******************************************************************************************************************************172.21.0.151 : ok=1 changed=1 unreachable=0 failed=0172.21.0.152 : ok=1 changed=1 unreachable=0 failed=0172.21.0.153 : ok=1 changed=1 unreachable=0 failed=0172.21.0.154 : ok=1 changed=1 unreachable=0 failed=0172.21.0.155 : ok=1 changed=1 unreachable=0 failed=0172.21.0.156 : ok=1 changed=1 unreachable=0 failed=0172.21.0.157 : ok=1 changed=1 unreachable=0 failed=0172.21.0.158 : ok=1 changed=1 unreachable=0 failed=0172.21.0.159 : ok=1 changed=1 unreachable=0 failed=0172.21.0.160 : ok=1 changed=1 unreachable=0 failed=0172.21.2.232 : ok=1 changed=1 unreachable=0 failed=0172.21.2.233 : ok=1 changed=1 unreachable=0 failed=0172.21.2.234 : ok=1 changed=1 unreachable=0 failed=0172.21.2.235 : ok=1 changed=1 unreachable=0 failed=0172.21.2.236 : ok=1 changed=1 unreachable=0 failed=0172.21.2.237 : ok=1 changed=1 unreachable=0 failed=0172.21.2.238 : ok=1 changed=1 unreachable=0 failed=0172.21.2.239 : ok=1 changed=1 unreachable=0 failed=0172.21.2.240 : ok=1 changed=1 unreachable=0 failed=0172.21.2.241 : ok=1 changed=1 unreachable=0 failed=0172.21.5.191 : ok=1 changed=1 unreachable=0 failed=0172.21.5.192 : ok=1 changed=1 unreachable=0 failed=0172.21.5.193 : ok=1 changed=1 unreachable=0 failed=0172.21.5.194 : ok=1 changed=1 unreachable=0 failed=0172.21.5.195 : ok=1 changed=1 unreachable=0 failed=0172.21.5.196 : ok=1 changed=1 unreachable=0 failed=0172.21.5.197 : ok=1 changed=1 unreachable=0 failed=0172.21.5.198 : ok=1 changed=1 unreachable=0 failed=0172.21.5.199 : ok=1 changed=1 unreachable=0 failed=0]]></content>
      <categories>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Cookie & Session]]></title>
    <url>%2F2019%2F04%2F07%2FCookie-Session%2F</url>
    <content type="text"><![CDATA[https://www.cnblogs.com/liwenzhou/p/8343243.html CookieCookieæ˜¯ä»€ä¹ˆä¿å­˜åœ¨æµè§ˆå™¨ç«¯çš„é”®å€¼å¯¹ ä¸ºä»€ä¹ˆè¦æœ‰Cookieå› ä¸ºHTTPè¯·æ±‚æ˜¯æ— çŠ¶æ€çš„ Cookieçš„åŽŸç†æœåŠ¡ç«¯å¯ä»¥åœ¨è¿”å›žå“åº”çš„æ—¶å€™ åšæ‰‹è„šåœ¨æµè§ˆå™¨ä¸Šå†™å…¥é”®å€¼å¯¹ï¼Œå°±æ˜¯Cookieï¼Œæµè§ˆå™¨å‘é€è¯·æ±‚çš„æ—¶å€™ä¼šè‡ªåŠ¨æºå¸¦è¯¥ç½‘ç«™ä¿å­˜åœ¨æµè§ˆå™¨ä¸­çš„é”®å€¼å¯¹ Cookieçš„ä½¿ç”¨åœºæ™¯ ä¿å­˜ç™»å½•ä¿¡æ¯ ä¿å­˜ç”¨æˆ·çš„æœç´¢å…³é”®è¯ Djangoä¸­æ“ä½œCookieèŽ·å–Cookie1234567request.COOKIES['key']request.get_signed_cookie(key, default=RAISE_ERROR, salt='', max_age=None)å‚æ•°ï¼š default: é»˜è®¤å€¼ salt: åŠ å¯†ç› max_age: åŽå°æŽ§åˆ¶è¿‡æœŸæ—¶é—´ è®¾ç½®Cookie123456789101112131415rep = HttpResponse(...)rep ï¼ render(request, ...)rep.set_cookie(key,value,...)rep.set_signed_cookie(key,value,salt='åŠ å¯†ç›', max_age=None, ...)å‚æ•°ï¼š key, é”® value='', å€¼ max_age=None, è¶…æ—¶æ—¶é—´ expires=None, è¶…æ—¶æ—¶é—´(IE requires expires, so set it if hasn't been already.) path='/', Cookieç”Ÿæ•ˆçš„è·¯å¾„ï¼Œ/ è¡¨ç¤ºæ ¹è·¯å¾„ï¼Œç‰¹æ®Šçš„ï¼šæ ¹è·¯å¾„çš„cookieå¯ä»¥è¢«ä»»ä½•urlçš„é¡µé¢è®¿é—® domain=None, Cookieç”Ÿæ•ˆçš„åŸŸå secure=False, httpsä¼ è¾“ httponly=False åªèƒ½httpåè®®ä¼ è¾“ï¼Œæ— æ³•è¢«JavaScriptèŽ·å–ï¼ˆä¸æ˜¯ç»å¯¹ï¼Œåº•å±‚æŠ“åŒ…å¯ä»¥èŽ·å–åˆ°ä¹Ÿå¯ä»¥è¢«è¦†ç›–ï¼‰ åˆ é™¤Cookie1234def logout(request): rep = redirect("/login/") rep.delete_cookie("user") # åˆ é™¤ç”¨æˆ·æµè§ˆå™¨ä¸Šä¹‹å‰è®¾ç½®çš„usercookieå€¼ return rep å®Œæ•´views.pyç¤ºä¾‹ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546# -*- coding: utf-8 -*-from __future__ import unicode_literalsfrom django.shortcuts import render,redirectfrom django.http import HttpResponse,HttpResponseRedirectfrom django.shortcuts import render# Create your views here.def check_login(func): def a(request,*args,**kwargs): Cookies = request.COOKIES.get("is_login", None) if 'yes' != Cookies: return redirect('/test01/login') else: return func(request,*args,**kwargs) return a@check_logindef index(request): return HttpResponse('indexç•Œé¢')@check_logindef home(request): return HttpResponse('home')def login(request): return render(request,'test01/login.html')@check_logindef logout(request): rep = redirect('/test01/login') rep.delete_cookie('is_login') return repdef check_username(request): if request.method == "POST": username = request.POST.get('username',None) password = request.POST.get('password',None) if username == 'z' and password == 'z': rep = render(request,'test01/home.html',&#123;'username':username&#125;) #rep.set_cookie('is_login','yes') rep.set_signed_cookie('is_login', 'yes', expires=60 * 60 * 24 * 7) else: rep = redirect('/test01/login') else: rep = redirect('/test01/login') return rep SessionCookieè™½ç„¶åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†â€œä¿æŒçŠ¶æ€â€çš„éœ€æ±‚ï¼Œä½†æ˜¯ç”±äºŽCookieæœ¬èº«æœ€å¤§æ”¯æŒ4096å­—èŠ‚ï¼Œä»¥åŠCookieæœ¬èº«ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œå¯èƒ½è¢«æ‹¦æˆªæˆ–çªƒå–ï¼Œå› æ­¤å°±éœ€è¦æœ‰ä¸€ç§æ–°çš„ä¸œè¥¿ï¼Œå®ƒèƒ½æ”¯æŒæ›´å¤šçš„å­—èŠ‚ï¼Œå¹¶ä¸”ä»–ä¿å­˜åœ¨æœåŠ¡å™¨ï¼Œæœ‰è¾ƒé«˜çš„å®‰å…¨æ€§ã€‚è¿™å°±æ˜¯Sessionã€‚ é—®é¢˜æ¥äº†ï¼ŒåŸºäºŽHTTPåè®®çš„æ— çŠ¶æ€ç‰¹å¾ï¼ŒæœåŠ¡å™¨æ ¹æœ¬å°±ä¸çŸ¥é“è®¿é—®è€…æ˜¯â€œè°â€ã€‚é‚£ä¹ˆä¸Šè¿°çš„Cookieå°±èµ·åˆ°æ¡¥æŽ¥çš„ä½œç”¨ã€‚ æˆ‘ä»¬å¯ä»¥ç»™æ¯ä¸ªå®¢æˆ·ç«¯çš„Cookieåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„idï¼Œè¿™æ ·ç”¨æˆ·åœ¨è®¿é—®æ—¶ï¼Œé€šè¿‡Cookieï¼ŒæœåŠ¡å™¨å°±çŸ¥é“æ¥çš„äººæ˜¯â€œè°â€ã€‚ç„¶åŽæˆ‘ä»¬å†æ ¹æ®ä¸åŒçš„Cookieçš„idï¼Œåœ¨æœåŠ¡å™¨ä¸Šä¿å­˜ä¸€æ®µæ—¶é—´çš„ç§å¯†èµ„æ–™ï¼Œå¦‚â€œè´¦å·å¯†ç â€ç­‰ç­‰ã€‚ æ€»ç»“è€Œè¨€ï¼šCookieå¼¥è¡¥äº†HTTPæ— çŠ¶æ€çš„ä¸è¶³ï¼Œè®©æœåŠ¡å™¨çŸ¥é“æ¥çš„äººæ˜¯â€œè°â€ï¼›ä½†æ˜¯Cookieä»¥æ–‡æœ¬çš„å½¢å¼ä¿å­˜åœ¨æœ¬åœ°ï¼Œè‡ªèº«å®‰å…¨æ€§è¾ƒå·®ï¼›æ‰€ä»¥æˆ‘ä»¬å°±é€šè¿‡Cookieè¯†åˆ«ä¸åŒçš„ç”¨æˆ·ï¼Œå¯¹åº”çš„åœ¨Sessioné‡Œä¿å­˜ç§å¯†çš„ä¿¡æ¯ä»¥åŠè¶…è¿‡4096å­—èŠ‚çš„æ–‡æœ¬ã€‚å¦å¤–ï¼Œä¸Šè¿°æ‰€è¯´çš„Cookieå’ŒSessionå…¶å®žæ˜¯å…±é€šæ€§çš„ä¸œè¥¿ï¼Œä¸é™äºŽè¯­è¨€å’Œæ¡†æž¶ã€‚ Djangoä¸­æ“ä½œSession1234567891011121314151617181920212223242526272829303132333435363738# èŽ·å–ã€è®¾ç½®ã€åˆ é™¤Sessionä¸­æ•°æ®request.session['k1']request.session.get('k1',None)request.session['k1'] = 123request.session.setdefault('k1',123) # å­˜åœ¨åˆ™ä¸è®¾ç½®del request.session['k1']# æ‰€æœ‰ é”®ã€å€¼ã€é”®å€¼å¯¹request.session.keys()request.session.values()request.session.items()request.session.iterkeys()request.session.itervalues()request.session.iteritems()# ä¼šè¯sessionçš„keyrequest.session.session_key# å°†æ‰€æœ‰Sessionå¤±æ•ˆæ—¥æœŸå°äºŽå½“å‰æ—¥æœŸçš„æ•°æ®åˆ é™¤request.session.clear_expired()# æ£€æŸ¥ä¼šè¯sessionçš„keyåœ¨æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨request.session.exists("session_key")# åˆ é™¤å½“å‰ä¼šè¯çš„æ‰€æœ‰Sessionæ•°æ®request.session.delete() # åˆ é™¤å½“å‰çš„ä¼šè¯æ•°æ®å¹¶åˆ é™¤ä¼šè¯çš„Cookieã€‚request.session.flush() è¿™ç”¨äºŽç¡®ä¿å‰é¢çš„ä¼šè¯æ•°æ®ä¸å¯ä»¥å†æ¬¡è¢«ç”¨æˆ·çš„æµè§ˆå™¨è®¿é—® ä¾‹å¦‚ï¼Œdjango.contrib.auth.logout() å‡½æ•°ä¸­å°±ä¼šè°ƒç”¨å®ƒã€‚# è®¾ç½®ä¼šè¯Sessionå’ŒCookieçš„è¶…æ—¶æ—¶é—´request.session.set_expiry(value) * å¦‚æžœvalueæ˜¯ä¸ªæ•´æ•°ï¼Œsessionä¼šåœ¨äº›ç§’æ•°åŽå¤±æ•ˆã€‚ * å¦‚æžœvalueæ˜¯ä¸ªdatatimeæˆ–timedeltaï¼Œsessionå°±ä¼šåœ¨è¿™ä¸ªæ—¶é—´åŽå¤±æ•ˆã€‚ * å¦‚æžœvalueæ˜¯0,ç”¨æˆ·å…³é—­æµè§ˆå™¨sessionå°±ä¼šå¤±æ•ˆã€‚ * å¦‚æžœvalueæ˜¯None,sessionä¼šä¾èµ–å…¨å±€sessionå¤±æ•ˆç­–ç•¥ã€‚ Seesionç‰ˆéªŒè¯ç™»å½•12345678910111213141516171819202122232425262728293031323334353637383940from functools import wrapsdef check_login(func): @wraps(func) def inner(request, *args, **kwargs): next_url = request.get_full_path() if request.session.get("user"): return func(request, *args, **kwargs) else: return redirect("/login/?next=&#123;&#125;".format(next_url)) return innerdef login(request): if request.method == "POST": user = request.POST.get("user") pwd = request.POST.get("pwd") if user == "alex" and pwd == "alex1234": # è®¾ç½®session request.session["user"] = user # èŽ·å–è·³åˆ°ç™»é™†é¡µé¢ä¹‹å‰çš„URL next_url = request.GET.get("next") # å¦‚æžœæœ‰ï¼Œå°±è·³è½¬å›žç™»é™†ä¹‹å‰çš„URL if next_url: return redirect(next_url) # å¦åˆ™é»˜è®¤è·³è½¬åˆ°indexé¡µé¢ else: return redirect("/index/") return render(request, "login.html")@check_logindef logout(request): # åˆ é™¤æ‰€æœ‰å½“å‰è¯·æ±‚ç›¸å…³çš„session request.session.delete() return redirect("/login/")@check_logindef index(request): current_user = request.session.get("user", None) return render(request, "index.html", &#123;"user": current_user&#125;) Djangoä¸­çš„Sessioné…ç½®12345678910111213141516171819202122232425261. æ•°æ®åº“SessionSESSION_ENGINE = 'django.contrib.sessions.backends.db' # å¼•æ“Žï¼ˆé»˜è®¤ï¼‰2. ç¼“å­˜SessionSESSION_ENGINE = 'django.contrib.sessions.backends.cache' # å¼•æ“ŽSESSION_CACHE_ALIAS = 'default' # ä½¿ç”¨çš„ç¼“å­˜åˆ«åï¼ˆé»˜è®¤å†…å­˜ç¼“å­˜ï¼Œä¹Ÿå¯ä»¥æ˜¯memcacheï¼‰ï¼Œæ­¤å¤„åˆ«åä¾èµ–ç¼“å­˜çš„è®¾ç½®3. æ–‡ä»¶SessionSESSION_ENGINE = 'django.contrib.sessions.backends.file' # å¼•æ“ŽSESSION_FILE_PATH = None # ç¼“å­˜æ–‡ä»¶è·¯å¾„ï¼Œå¦‚æžœä¸ºNoneï¼Œåˆ™ä½¿ç”¨tempfileæ¨¡å—èŽ·å–ä¸€ä¸ªä¸´æ—¶åœ°å€tempfile.gettempdir() 4. ç¼“å­˜+æ•°æ®åº“SESSION_ENGINE = 'django.contrib.sessions.backends.cached_db' # å¼•æ“Ž5. åŠ å¯†Cookie SessionSESSION_ENGINE = 'django.contrib.sessions.backends.signed_cookies' # å¼•æ“Žå…¶ä»–å…¬ç”¨è®¾ç½®é¡¹ï¼šSESSION_COOKIE_NAME ï¼ "sessionid" # Sessionçš„cookieä¿å­˜åœ¨æµè§ˆå™¨ä¸Šæ—¶çš„keyï¼Œå³ï¼šsessionidï¼éšæœºå­—ç¬¦ä¸²ï¼ˆé»˜è®¤ï¼‰SESSION_COOKIE_PATH ï¼ "/" # Sessionçš„cookieä¿å­˜çš„è·¯å¾„ï¼ˆé»˜è®¤ï¼‰SESSION_COOKIE_DOMAIN = None # Sessionçš„cookieä¿å­˜çš„åŸŸåï¼ˆé»˜è®¤ï¼‰SESSION_COOKIE_SECURE = False # æ˜¯å¦Httpsä¼ è¾“cookieï¼ˆé»˜è®¤ï¼‰SESSION_COOKIE_HTTPONLY = True # æ˜¯å¦Sessionçš„cookieåªæ”¯æŒhttpä¼ è¾“ï¼ˆé»˜è®¤ï¼‰SESSION_COOKIE_AGE = 1209600 # Sessionçš„cookieå¤±æ•ˆæ—¥æœŸï¼ˆ2å‘¨ï¼‰ï¼ˆé»˜è®¤ï¼‰SESSION_EXPIRE_AT_BROWSER_CLOSE = False # æ˜¯å¦å…³é—­æµè§ˆå™¨ä½¿å¾—Sessionè¿‡æœŸï¼ˆé»˜è®¤ï¼‰SESSION_SAVE_EVERY_REQUEST = False # æ˜¯å¦æ¯æ¬¡è¯·æ±‚éƒ½ä¿å­˜Sessionï¼Œé»˜è®¤ä¿®æ”¹ä¹‹åŽæ‰ä¿å­˜ï¼ˆé»˜è®¤ï¼‰]]></content>
      <tags>
        <tag>Cookie</tag>
        <tag>Session</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginx_é…ç½®SSLè¯ä¹¦]]></title>
    <url>%2F2019%2F04%2F05%2FNginx-%E9%85%8D%E7%BD%AESSL%E8%AF%81%E4%B9%A6%2F</url>
    <content type="text"><![CDATA[èŽ·å–è¯ä¹¦å¹¶ä¸Šä¼ åˆ°NgxæœåŠ¡å™¨ æ£€æŸ¥Ngxæ˜¯å¦å®‰è£…â€“with-http_ssl_moduleæ¨¡å— ä¿®æ”¹nginxé…ç½®æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233server &#123; listen 80; server_name *.zhaohongye.com; #return 301 https://$host$request_uri; return 301 https://zhaohongye.com;&#125;server &#123; listen 443 ssl; server_name zhaohongye.com www.zhaohongye.com; access_log /var/log/nginx/zhy.log main; error_log /var/log/nginx/zhy.error.log; ssl on; #sslåŠŸèƒ½å¼€å¯ ssl_certificate sslfile/2027481_zhaohongye.com.pem; ssl_certificate_key sslfile/2027481_zhaohongye.com.key; location / &#123; proxy_set_header Host $host:$server_port; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_redirect http:// https://; proxy_pass http://127.0.0.1:4000; client_max_body_size 10M; proxy_set_header X-Forwarded-Host $host; proxy_set_header X-Forwarded-Server $host; # Required for new HTTP-based CLI proxy_http_version 1.1; proxy_request_buffering off; &#125;&#125; httpsè®¿é—®éªŒè¯]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Archer]]></title>
    <url>%2F2019%2F04%2F05%2FArcher-SQL%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B9%B3%E5%8F%B0%2F</url>
    <content type="text"><![CDATA[ARCHER â€” è‡ªåŠ¨åŒ–SQLæ“ä½œå¹³å°åŸºäºŽinceptionçš„è‡ªåŠ¨åŒ–SQLæ“ä½œå¹³å°ï¼Œæ”¯æŒSQLæ‰§è¡Œã€LDAPè®¤è¯ã€å‘é‚®ä»¶ã€OSCã€SQLæŸ¥è¯¢ã€SQLä¼˜åŒ–å»ºè®®ã€æƒé™ç®¡ç†ç­‰åŠŸèƒ½ï¼Œæ”¯æŒdockeré•œåƒã€‚ GitHubé¡¹ç›®åœ°å€ï¼šhttps://github.com/jly8866/archer ä¸»è¦åŠŸèƒ½ è‡ªåŠ¨å®¡æ ¸å‘èµ·SQLä¸Šçº¿ï¼Œå·¥å•æäº¤ï¼Œç”±inceptionè‡ªåŠ¨å®¡æ ¸ï¼Œå®¡æ ¸é€šè¿‡åŽéœ€è¦ç”±å®¡æ ¸äººè¿›è¡Œäººå·¥å®¡æ ¸ äººå·¥å®¡æ ¸inceptionè‡ªåŠ¨å®¡æ ¸é€šè¿‡çš„å·¥å•ï¼Œç”±å…¶ä»–ç ”å‘å·¥ç¨‹å¸ˆæˆ–ç ”å‘ç»ç†æ¥å®¡æ ¸ï¼ŒDBAæ“ä½œæ‰§è¡ŒSQLä¸ºä»€ä¹ˆè¦æœ‰äººå·¥å®¡æ ¸ï¼Ÿè¿™æ˜¯éµå¾ªè¿ç»´é¢†åŸŸçº¿ä¸Šæ“ä½œçš„æµç¨‹æ„è¯†ï¼Œä¸€ä¸ªå·¥ç¨‹å¸ˆè¦è¿›è¡Œçº¿ä¸Šæ•°æ®åº“SQLæ›´æ–°ï¼Œæœ€å¥½ç”±å¦å¤–ä¸€ä¸ªå·¥ç¨‹å¸ˆæ¥æŠŠå…³å¾ˆå¤šæ—¶å€™DBAå¹¶ä¸çŸ¥é“SQLçš„ä¸šåŠ¡å«ä¹‰ï¼Œæ‰€ä»¥äººå·¥å®¡æ ¸æœ€å¥½ç”±å…¶ä»–ç ”å‘å·¥ç¨‹å¸ˆæˆ–ç ”å‘ç»ç†æ¥å®¡æ ¸. è¿™æ˜¯archerçš„è®¾è®¡ç†å¿µ å›žæ»šæ•°æ®å±•ç¤ºå·¥å•å†…å¯å±•ç¤ºå›žæ»šè¯­å¥ï¼Œæ”¯æŒä¸€é”®æäº¤å›žæ»šå·¥å• å®šæ—¶æ‰§è¡ŒSQLå®¡æ ¸é€šè¿‡çš„å·¥å•å¯ç”±DBAé€‰æ‹©å®šæ—¶æ‰§è¡Œï¼Œæ‰§è¡Œå‰å¯ä¿®æ”¹æ‰§è¡Œæ—¶é—´ï¼Œå¯éšæ—¶ç»ˆæ­¢ pt-oscæ‰§è¡Œæ”¯æŒpt-oscæ‰§è¡Œè¿›åº¦å±•ç¤ºï¼Œå¹¶ä¸”å¯ä»¥ç‚¹å‡»ä¸­æ­¢pt-oscè¿›ç¨‹ MySQLæŸ¥è¯¢åº“ã€è¡¨ã€å…³é”®å­—è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢ç»“æžœé›†é™åˆ¶ã€æŸ¥è¯¢ç»“æžœå¯¼å‡ºã€è¡¨ç»“æž„å±•ç¤ºã€å¤šç»“æžœé›†å±•ç¤º MySQLæŸ¥è¯¢æƒé™ç®¡ç†åŸºäºŽinceptionè§£æžæŸ¥è¯¢è¯­å¥ï¼ŒæŸ¥è¯¢æƒé™æ”¯æŒé™åˆ¶åˆ°è¡¨çº§æŸ¥è¯¢æƒé™ç”³è¯·ã€å®¡æ ¸å’Œç®¡ç†ï¼Œæ”¯æŒå®¡æ ¸æµç¨‹é…ç½®ï¼Œå¤šçº§å®¡æ ¸ MySQLæŸ¥è¯¢åŠ¨æ€è„±æ•åŸºäºŽinceptionè§£æžæŸ¥è¯¢è¯­å¥ï¼Œé…åˆè„±æ•å­—æ®µé…ç½®ã€è„±æ•è§„åˆ™(æ­£åˆ™è¡¨è¾¾å¼)å®žçŽ°æ•æ„Ÿæ•°æ®åŠ¨æ€è„±æ• æ…¢æ—¥å¿—ç®¡ç†åŸºäºŽpercona-toolkitçš„pt_query_digeståˆ†æžå’Œå­˜å‚¨æ…¢æ—¥å¿—ï¼Œå¹¶åœ¨webç«¯å±•çŽ° é‚®ä»¶é€šçŸ¥å¯é…ç½®é‚®ä»¶æé†’ï¼Œå¯¹ä¸Šçº¿ç”³è¯·ã€æƒé™ç”³è¯·ã€å®¡æ ¸ç»“æžœç­‰è¿›è¡Œé€šçŸ¥å¯¹å¼‚å¸¸ç™»å½•è¿›è¡Œé€šçŸ¥ å®‰è£…å®‰è£…docker ã€git1yum install -y docker git ä¸‹è½½é•œåƒ123docker pull hhyo/inceptiondocker pull hhyo/archerdocker pull mysql:5.6.35 åˆ›å»ºarcheré…ç½®æ–‡ä»¶æœåŠ¡ç›®å½•å®šä¸º /vcg/archer/ 1mkdir /vcg/archer/ 123456789101112131415161718192021222324vim /vcg/archer/inc.cnf[inception]general_log=1general_log_file=inception.logport=6669socket=/tmp/inc.socketcharacter-set-client-handshake=0character-set-server=utf8inception_remote_system_password=rootinception_remote_system_user=wzf1inception_remote_backup_port=3306inception_remote_backup_host=127.0.0.1inception_support_charset=utf8,utf8mb4inception_enable_nullable=0inception_check_primary_key=1inception_check_column_comment=1inception_check_table_comment=1inception_osc_on=OFFinception_osc_bin_dir=/usr/bininception_osc_min_table_size=1inception_osc_chunk_time=0.1inception_enable_blob_type=1inception_check_column_default_value=1 12wget https://github.com/jly8866/archer/blob/master/archer/settings.pyä¿®æ”¹å…¶ä¸­çš„æ•°æ®åº“åœ°å€ã€ç”¨æˆ·åã€å¯†ç  å¯åŠ¨å®¹å™¨12345docker run --name inception -v /vcg/archer/inc.cnf:/etc/inc.cnf -p 6669:6669 -dti hhyo/inceptiondocker run --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.6.35docker run --name archer -v /vcg/archer/settings.py:/opt/archer/archer/settings.py -e NGINX_PORT=9123 -p 9123:9123 -dti hhyo/archer åˆ›å»ºæ•°æ®åº“123mysql -uroot -pCREATE DATABASE IF NOT EXISTS archer_github DEFAULT CHARSET utf8 COLLATE utf8_general_ci; åˆå§‹åŒ–æ•°æ®åº“12345678docker exec -ti archer /bin/bash cd /opt/archer source /opt/venv4archer/bin/activate # åˆå§‹åŒ–æ•°æ®åº“ python3 manage.py makemigrations sql python3 manage.py migrate # åˆ›å»ºç®¡ç†å‘˜è´¦å· python3 manage.py createsuperuser è®¿é—®åœ°å€ï¼š http://xxxx::9123/]]></content>
      <categories>
        <category>Archer</category>
      </categories>
      <tags>
        <tag>Archer</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hexo]]></title>
    <url>%2F2019%2F04%2F05%2FHexo-%E5%8D%9A%E5%AE%A2%2F</url>
    <content type="text"><![CDATA[å¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æž¶å®˜ç½‘: https://hexo.io ç‰¹ç‚¹è¶…å¿«é€Ÿåº¦Node.js æ‰€å¸¦æ¥çš„è¶…å¿«ç”Ÿæˆé€Ÿåº¦ï¼Œè®©ä¸Šç™¾ä¸ªé¡µé¢åœ¨å‡ ç§’å†…çž¬é—´å®Œæˆæ¸²æŸ“ã€‚ æ”¯æŒ MarkdownHexo æ”¯æŒ GitHub Flavored Markdown çš„æ‰€æœ‰åŠŸèƒ½ï¼Œç”šè‡³å¯ä»¥æ•´åˆ Octopress çš„å¤§å¤šæ•°æ’ä»¶ã€‚ ä¸€é”®éƒ¨ç½²åªéœ€ä¸€æ¡æŒ‡ä»¤å³å¯éƒ¨ç½²åˆ° GitHub Pages, Heroku æˆ–å…¶ä»–ç½‘ç«™ã€‚ ä¸°å¯Œçš„æ’ä»¶Hexo æ‹¥æœ‰å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿï¼Œå®‰è£…æ’ä»¶å¯ä»¥è®© Hexo æ”¯æŒ Jade, CoffeeScriptã€‚ 12345$ npm install hexo-cli -g$ hexo init blog$ cd blog$ npm install$ hexo server æœ€ä½³å®žè·µå‘½ä»¤ç¼©å†™hexoæ”¯æŒæŒ‡ä»¤ç¼©å†™ï¼Œä¾‹å¦‚ï¼šhexo generateå’Œhexo gæ˜¯ç­‰æ•ˆçš„ã€‚d = deploy éƒ¨ç½²g = generate ç”Ÿæˆé™æ€é¡µé¢l = log å¯åŠ¨æ—¥è®°è®°å½•ï¼Œä½¿ç”¨è¦†ç›–è®°å½•æ ¼å¼n = new æ–°å»ºæ–‡ç« o = output è®¾ç½®è¾“å‡ºè·¯å¾„p = port é‡è®¾ç«¯å£s = server å¯åŠ¨æœåŠ¡å™¨w = watch ç›‘è§†æ–‡ä»¶å˜åŠ¨ ç»„åˆå‘½ä»¤1hexo clean &amp;&amp; hexo g &amp;&amp; hexo d ä¿®æ”¹é¦–é¡µåšå®¢ä¸ºé¢„è§ˆæ¨¡å¼12345vim themes/next/_config.ymlauto_excerpt: enable: false length: 150 å°† auto_excerptçš„enableå‚æ•°ç”±falseæ”¹ä¸ºtrue]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Kubernetes_Nginx-Ingress]]></title>
    <url>%2F2019%2F04%2F05%2FKubernetes-Nginx-Ingress%2F</url>
    <content type="text"><![CDATA[For example12345678910111213141516171819202122232425262728293031apiVersion: extensions/v1beta1kind: Ingressmetadata: annotations: nginx.ingress.kubernetes.io/force-ssl-redirect: 'true' #ä»£è¡¨å…¶ä¸­è·³è½¬ nginx.ingress.kubernetes.io/service-weight: '' nginx.ingress.kubernetes.io/ssl-redirect: 'true' creationTimestamp: '2018-12-25T10:29:36Z' generation: 1 name: boss namespace: default resourceVersion: '21429383' selfLink: /apis/extensions/v1beta1/namespaces/default/ingresses/boss uid: fa56e2a0-082f-11e9-80cf-00163e0e2421spec: rules: - host: boss1.vcg.com http: paths: - backend: serviceName: node-vcg-boss servicePort: 80 path: / tls: - hosts: - boss1.vcg.com secretName: vcg-httpsstatus: loadBalancer: ingress: - ip: 39.97.21.16]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello World]]></title>
    <url>%2F2019%2F04%2F03%2Fhello-world%2F</url>
    <content type="text"><![CDATA[Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new "My New Post" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment]]></content>
  </entry>
</search>
